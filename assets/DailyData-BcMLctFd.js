import{d as z,r as c,c as h,w as x,o as F,a as G,b as H,e as C,f as M,v as J,g as l,h as s,i as d,j as R,k as S,l as p,u as g,n as K,t as w,m as Q,p as D,_ as W}from"./index-Cgwn2gPE.js";import{a as X,g as Y,P as Z,V as ee,b as ae}from"./PlayerDetail-B5srduna.js";import{u as te,p as oe}from"./table-mixins-BT8enfsl.js";const le={class:"data-detail"},se={class:"mb-4"},ne={class:"table-scroll-container"},re=z({__name:"DailyData",setup(ie){const n=X(),{handleSortChange:V}=te(),$=[{title:"日期",dataIndex:"date",key:"date",width:100,sorter:(a,e)=>(console.log(`排序比较: ${a.date} vs ${e.date}`),new Date(e.date).getTime()-new Date(a.date).getTime())},{title:"玩家ID",dataIndex:"id",key:"id",flex:1,width:250},{title:"职业",dataIndex:"profession",key:"profession",width:100},{title:"分均倒地（次）",dataIndex:"downPerMinute",key:"downPerMinute",width:150,sorter:(a,e)=>a.downPerMinute-e.downPerMinute},{title:"分均死亡率（%）",dataIndex:"deathPerMinute",key:"deathPerMinute",width:150,sorter:(a,e)=>a.deathPerMinute-e.deathPerMinute},{title:"战斗时间（s）",dataIndex:"durationInCombat",key:"durationInCombat",width:150,sorter:(a,e)=>a.durationInCombat-e.durationInCombat},{title:"评分",dataIndex:"score",key:"score",width:150,sorter:(a,e)=>a.score-e.score},{title:"操作",key:"action",width:200}],r=c(!1),m=c([]),f=c(!1),T=Y(),P=c([]),o=c({dateRange:T,playerIds:[],profession:null}),N=h(()=>n.professionNameList),B=h(()=>o.value.profession?n.uniquePlayerProfessions.filter(a=>a.profession===o.value.profession):n.uniquePlayerProfessions),O=h(()=>{if(!m.value)return[];let a=[];return m.value.forEach(e=>{e.data.forEach(i=>{const v=`${i.id}:${i.profession}`,u=!o.value.profession||i.profession===o.value.profession,y=o.value.playerIds.length===0||o.value.playerIds.includes(v);u&&y&&a.push({key:`${e.date}-${v}`,date:e.date,...i})})}),a.sort((e,i)=>new Date(i.date).getTime()-new Date(e.date).getTime()),a}),k=(a,e)=>e.label.toLowerCase().indexOf(a.toLowerCase())>=0;x(()=>o.value.profession,()=>{o.value.playerIds=[]});const b=async()=>{r.value=!0;try{m.value=await n.filterAllPlayerDateData({dateRange:o.value.dateRange,playerIds:[],profession:null})}catch(a){console.error("加载数据失败:",a),R.error("加载数据失败")}finally{r.value=!1}},A=async()=>{r.value=!0;try{await n.getAllPlayerDateData()}catch(a){console.error("加载数据失败:",a),R.error("加载数据失败")}finally{r.value=!1}};x(()=>o.value.dateRange,()=>{b()}),F(async()=>{(!n.allPlayerData||n.allPlayerData.length===0)&&(await A(),n.getPlayerProfessionData()),b(),console.log("allPlayerDataStore",n)}),Q();const I=a=>{f.value=!0,P.value={date:a.date,score:a.score,playerId:a.id,profession:a.profession}},E=()=>{f.value=!1};return(a,e)=>{const i=d("a-typography-title"),v=d("a-range-picker"),u=d("a-col"),y=d("a-select"),L=d("a-row"),_=d("a-button"),U=d("a-Image"),q=d("a-card");return D(),G("div",le,[H(l(q,{class:"shadow-lg card-container"},{default:s(()=>[l(i,{level:4},{default:s(()=>e[3]||(e[3]=[p("每日数据明细")])),_:1,__:[3]}),S("div",se,[l(L,{gutter:[16,16],style:{margin:"0 auto 0 0","max-width":"900px"}},{default:s(()=>[l(u,{span:24,xs:24,sm:12,md:8,lg:8},{default:s(()=>[l(v,{value:o.value.dateRange,"onUpdate:value":e[0]||(e[0]=t=>o.value.dateRange=t),disabled:r.value,style:{width:"100%"}},null,8,["value","disabled"])]),_:1}),l(u,{span:24,xs:24,sm:12,md:8,lg:8},{default:s(()=>[l(y,{value:o.value.profession,"onUpdate:value":e[1]||(e[1]=t=>o.value.profession=t),options:N.value,placeholder:"选择职业",disabled:r.value,style:{width:"100%"},"allow-clear":"","show-search":"","filter-option":k},null,8,["value","options","disabled"])]),_:1}),l(u,{span:24,xs:24,sm:12,md:8,lg:8},{default:s(()=>[l(y,{value:o.value.playerIds,"onUpdate:value":e[2]||(e[2]=t=>o.value.playerIds=t),options:B.value,placeholder:"选择玩家",disabled:r.value,style:{width:"100%"},mode:"multiple","allow-clear":"","show-search":"","filter-option":k},null,8,["value","options","disabled"])]),_:1})]),_:1})]),S("div",ne,[l(ee,{data:O.value,columns:$,"body-height":800,onSortChange:g(V),loading:r.value,scroll:{x:"100%"}},{"cell-id":s(({row:t})=>[l(_,{type:"link",onClick:j=>I(t)},{default:s(()=>[p(w(t.id),1)]),_:2},1032,["onClick"]),t.pin?(D(),C(U,{key:0,width:20,preview:!1,src:g(oe)},null,8,["src"])):M("",!0)]),"cell-deathPerMinute":s(({row:t})=>[p(w(t.deathPerMinute?Number((t.deathPerMinute*100).toFixed(2)):t.deathPerMinute===0?0:""),1)]),"cell-score":s(({row:t})=>[l(_,{style:K({color:"#fff",background:g(ae)(t.score)})},{default:s(()=>[p(w(t.score),1)]),_:2},1032,["style"])]),"cell-action":s(({row:t})=>[l(_,{type:"link",onClick:j=>I(t)},{default:s(()=>e[4]||(e[4]=[p(" 查看明细 ")])),_:2,__:[4]},1032,["onClick"])]),_:1},8,["data","onSortChange","loading"])])]),_:1},512),[[J,!f.value]]),f.value?(D(),C(Z,{key:0,playerDetailData:P.value,onGoBack:E},null,8,["playerDetailData"])):M("",!0)])}}}),pe=W(re,[["__scopeId","data-v-547b5a6c"]]);export{pe as default};
