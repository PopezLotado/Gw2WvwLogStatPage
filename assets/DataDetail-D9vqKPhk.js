import{l as j,a as I,d as q,r as f,c as R,w as S,o as G,b as L,m as C,v as A,e as c,f as _,g as v,h as Y,i as H,j as k,n as z,p as T,t as J,q as K,u as Q,s as W,k as b,_ as X}from"./index-Csd5hoqn.js";import{f as Z,l as ee,g as ae}from"./dataLoader-9A2T7_HB.js";import{P as te,g as oe}from"./PlayerDetail-DfkGxt-Q.js";const le=j("counter",{state:()=>({allPlayerData:[]}),getters:{},actions:{async getAllPlayerDateData(){this.allPlayerData=await ee({dateRange:[I("2025-05-01"),I()],playerIds:[],profession:null}),console.log("%c [ getAllPlayerDateData ]-18","font-size:13px; background:pink; color:#bf2c9f;",this.allPlayerData)},filterAllPlayerDateData(n){try{const y=n.dateRange[0].format("YYYY-MM-DD"),w=n.dateRange[1].format("YYYY-MM-DD");return Z(y,w).map(u=>{let l=this.allPlayerData.filter(p=>p.date===u);return console.log("%c [ filteredData ]-45","font-size:13px; background:pink; color:#bf2c9f;",l),n.playerIds.length>0&&(l=l.filter(p=>n.playerIds.includes(p.id))),n.profession&&(l=l.filter(p=>p.profession===n.profession)),l[0]}).filter(u=>(console.log("%c [ result ]-59","font-size:13px; background:pink; color:#bf2c9f;",u),u.data.length>0))}catch(y){return console.error("加载数据失败:",y),[]}},setAllPlayerData(n){this.allPlayerData=n}}}),se={class:"data-detail"},re={class:"mb-4"},ne=q({__name:"DataDetail",setup(n){const y=le(),w=[{title:"日期",dataIndex:"date",key:"date",width:120,sorter:(e,a)=>(console.log(`排序比较: ${e.date} vs ${a.date}`),new Date(a.date).getTime()-new Date(e.date).getTime())},{title:"玩家ID",dataIndex:"id",key:"id",width:200},{title:"职业",dataIndex:"profession",key:"profession",width:120},{title:"评分",dataIndex:"score",key:"score",width:120,sorter:(e,a)=>e.score-a.score},{title:"操作",key:"action",width:120,fixed:"right"}],i=f(!1),D=f([]),m=f(!1),u=f([]),l=f([]),p=ae(),P=f([]),t=f({dateRange:p,playerIds:[],profession:null}),V=R(()=>t.value.profession?l.value.filter(e=>e.profession===t.value.profession).sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})):l.value.sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`}))),B=R(()=>{if(!D.value)return[];let e=[];return D.value.forEach(a=>{a.data.forEach(o=>{const d=`${o.id}:${o.profession}`,s=!t.value.profession||o.profession===t.value.profession,g=t.value.playerIds.length===0||t.value.playerIds.includes(d);s&&g&&e.push({key:`${a.date}-${d}`,date:a.date,...o})})}),e.sort((a,o)=>new Date(o.date).getTime()-new Date(a.date).getTime()),e});S(()=>t.value.profession,()=>{t.value.playerIds=[]});const E=()=>{if(!D.value)return;const e=new Set,a=new Set,o=[];D.value.forEach(d=>{d.data.forEach(s=>{e.add(s.profession);const g=`${s.id}:${s.profession}`;a.has(g)||(a.add(g),o.push({id:s.id,profession:s.profession}))})}),u.value=Array.from(e).sort().map(d=>({label:d,value:d})),l.value=o},x=()=>{i.value=!0;try{const e=y.filterAllPlayerDateData({dateRange:t.value.dateRange,playerIds:[],profession:null});D.value=e,E()}catch(e){console.error("加载数据失败:",e),Y.error("加载数据失败")}finally{i.value=!1}},F=async()=>{i.value=!0;try{await y.getAllPlayerDateData()}catch(e){console.error("加载数据失败:",e),Y.error("加载数据失败")}finally{i.value=!1}};S(()=>t.value.dateRange,()=>{x()}),G(async()=>{await F(),x()}),W();const M=e=>{m.value=!0,P.value={date:e.date,score:Number(e.score.toFixed(2)),playerId:e.id,profession:e.profession}},N=e=>{m.value=!1};return(e,a)=>{const o=v("a-typography-title"),d=v("a-range-picker"),s=v("a-select"),g=v("a-space"),$=v("a-button"),O=v("a-table"),U=v("a-card");return b(),L("div",se,[C(c(U,{class:"shadow-lg"},{default:_(()=>[c(o,{level:4},{default:_(()=>a[3]||(a[3]=[k("数据明细")])),_:1,__:[3]}),H("div",re,[c(g,null,{default:_(()=>[c(d,{value:t.value.dateRange,"onUpdate:value":a[0]||(a[0]=r=>t.value.dateRange=r),disabled:i.value,style:{width:"280px"}},null,8,["value","disabled"]),c(s,{value:t.value.profession,"onUpdate:value":a[1]||(a[1]=r=>t.value.profession=r),options:u.value,placeholder:"选择职业",disabled:i.value,style:{width:"200px"},"allow-clear":""},null,8,["value","options","disabled"]),c(s,{value:t.value.playerIds,"onUpdate:value":a[2]||(a[2]=r=>t.value.playerIds=r),options:V.value,placeholder:"选择玩家",disabled:i.value,style:{width:"300px"},mode:"multiple","allow-clear":""},null,8,["value","options","disabled"])]),_:1})]),c(O,{columns:w,"data-source":B.value,loading:i.value,pagination:{showSizeChanger:!0,pageSize:500,pageSizeOptions:["200","400","500","1000"],showTotal:r=>`共 ${r} 条数据`}},{bodyCell:_(({column:r,record:h})=>[r.key==="score"?(b(),z($,{key:0,style:K({color:"#fff",background:Q(oe)(h.score?h.score.toFixed(2):"")})},{default:_(()=>[k(J(h.score?h.score.toFixed(2):""),1)]),_:2},1032,["style"])):T("",!0),r.key==="action"?(b(),z($,{key:1,type:"link",onClick:ie=>M(h)},{default:_(()=>a[4]||(a[4]=[k(" 查看明细 ")])),_:2,__:[4]},1032,["onClick"])):T("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1},512),[[A,!m.value]]),C(c(te,{playerDetailData:P.value,onGoBack:N},null,8,["playerDetailData"]),[[A,m.value]])])}}}),pe=X(ne,[["__scopeId","data-v-4802d932"]]);export{pe as default};
