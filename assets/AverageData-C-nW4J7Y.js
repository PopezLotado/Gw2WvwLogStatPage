import{d as E,r as f,c as _,w as G,o as $,a as g,b as H,e as v,f as S,v as J,g as n,h as l,i as r,j as V,k as m,l as c,F as q,q as A,u as D,n as K,t as y,m as Q,p as u,_ as W}from"./index-DKxtguuM.js";import{a as X,g as Y,P as Z,V as ee,b as ae}from"./PlayerDetail-H6pS18TR.js";import{u as te,p as le}from"./table-mixins-D9bXv3gu.js";const oe={class:"data-detail"},se={class:"mb-4"},ne={class:"table-scroll-container"},re=E({__name:"AverageData",setup(ie){const o=X(),{handleSortChange:B}=te(),N=[{title:"玩家ID",dataIndex:"id",key:"id",width:200,flex:1},{title:"职业",dataIndex:"profession",key:"profession",flex:1,width:60,sorter:(e,a)=>e.profession-a.profession},{title:"平均分",dataIndex:"average",key:"average",width:120,flex:1,sorter:(e,a)=>e.average-a.average},{title:"出场次数",dataIndex:"frequency",key:"frequency",width:120,flex:1,sorter:(e,a)=>e.frequency-a.frequency},{title:"操作",key:"action",width:120}],i=f(!1),p=f(!1),O=Y(),h=f([]),s=f({dateRange:O,playerIds:[],profession:null}),w=_(()=>o.professionNameList),b=_(()=>s.value.profession?o.uniquePlayerProfessions.filter(e=>e.profession===s.value.profession):o.uniquePlayerProfessions),L=_(()=>o.filterAverageDateData({playerIds:s.value.playerIds,profession:s.value.profession})),x=(e,a)=>a.label.toLowerCase().indexOf(e.toLowerCase())>=0;G(()=>s.value.profession,()=>{s.value.playerIds=[]});const R=()=>{i.value=!0;try{o.getPlayerProfessionData()}catch(e){console.error("加载数据失败:",e),V.error("加载数据失败")}finally{i.value=!1}},T=async()=>{i.value=!0;try{await o.getAllPlayerDateData()}catch(e){console.error("加载数据失败:",e),V.error("加载数据失败")}finally{i.value=!1}};$(async()=>{(!o.allPlayerData||o.allPlayerData.length===0)&&(await T(),o.getPlayerProfessionData()),console.log("allPlayerDataStore",o),R()}),Q();const F=e=>{p.value=!0;const a=o.getPlayerAvailableDates(e.id,e.profession);let d=o.getSpecificPlayerDataByDate(e.id,e.profession,a[a.length-1]);console.log("handleViewDetail",d,a,e),h.value={date:d.date,score:d.score,playerId:e.id,profession:e.profession}},M=e=>{p.value=!1};return(e,a)=>{const d=r("a-typography-title"),k=r("a-select-option"),P=r("a-select"),I=r("a-col"),U=r("a-row"),j=r("a-Image"),C=r("a-button"),z=r("a-card");return u(),g("div",oe,[H(n(z,{class:"shadow-lg card-container"},{default:l(()=>[n(d,{level:4},{default:l(()=>a[2]||(a[2]=[c("历史平均分排名")])),_:1,__:[2]}),m("div",se,[n(U,{gutter:[16,16],style:{margin:"0px auto 0 0","max-width":"900px"}},{default:l(()=>[n(I,{span:24,xs:24,sm:12,md:8,lg:8},{default:l(()=>[n(P,{value:s.value.profession,"onUpdate:value":a[0]||(a[0]=t=>s.value.profession=t),options:w.value,placeholder:"选择职业",disabled:i.value,style:{width:"100%"},"allow-clear":"","show-search":"","filter-option":x},{default:l(()=>[(u(!0),g(q,null,A(w.value,t=>(u(),v(k,{key:t.value,value:t.value},{default:l(()=>[c(y(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","options","disabled"])]),_:1}),n(I,{span:24,xs:24,sm:12,md:8,lg:8},{default:l(()=>[n(P,{value:s.value.playerIds,"onUpdate:value":a[1]||(a[1]=t=>s.value.playerIds=t),options:b.value,placeholder:"选择玩家",disabled:i.value,style:{width:"100%"},mode:"multiple","allow-clear":"","show-search":"","filter-option":x},{default:l(()=>[(u(!0),g(q,null,A(b.value,t=>(u(),v(k,{key:t.value,value:t.value},{default:l(()=>[c(y(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","options","disabled"])]),_:1})]),_:1})]),m("div",ne,[n(ee,{data:L.value,columns:N,"body-height":800,onSortChange:D(B),loading:i.value,scroll:{x:"100%"}},{"cell-id":l(({row:t})=>[m("span",null,y(t.id),1),t.pin?(u(),v(j,{key:0,width:20,preview:!1,src:D(le)},null,8,["src"])):S("",!0)]),"cell-average":l(({row:t})=>[n(C,{style:K({color:"#fff",background:D(ae)(t.average)})},{default:l(()=>[c(y(t.average),1)]),_:2},1032,["style"])]),"cell-action":l(({row:t})=>[n(C,{type:"link",onClick:ue=>F(t)},{default:l(()=>a[3]||(a[3]=[c(" 查看明细 ")])),_:2,__:[3]},1032,["onClick"])]),_:1},8,["data","onSortChange","loading"])])]),_:1},512),[[J,!p.value]]),p.value?(u(),v(Z,{key:0,playerDetailData:h.value,onGoBack:M},null,8,["playerDetailData"])):S("",!0)])}}}),fe=W(re,[["__scopeId","data-v-f8a56aef"]]);export{fe as default};
