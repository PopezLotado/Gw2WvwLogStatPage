import{d as L,r as u,c as x,w as P,o as M,b as C,l as H,m,n as _,v as J,e as p,f,g as i,h as S,i as R,j as h,F as K,t as T,u as F,p as Q,q as W,k as v,_ as X}from"./index-Dk6DOUBB.js";import{g as Y}from"./dataLoader-CdjgbJhp.js";import{a as Z,P as ee,g as ae}from"./PlayerDetail-EK_FcSRx.js";const te="/assets/pin-Cs6GTirN.png",oe={class:"data-detail"},se={class:"mb-4"},le=L({__name:"DataDetail",setup(ne){const D=Z(),N=[{title:"日期",dataIndex:"date",key:"date",width:120,sorter:(e,a)=>(console.log(`排序比较: ${e.date} vs ${a.date}`),new Date(a.date).getTime()-new Date(e.date).getTime())},{title:"玩家ID",dataIndex:"id",key:"id",width:200},{title:"职业",dataIndex:"profession",key:"profession",width:120},{title:"评分",dataIndex:"score",key:"score",width:120,sorter:(e,a)=>e.score-a.score},{title:"操作",key:"action",width:120,fixed:"right"}],r=u(!1),y=u([]),g=u(!1),k=u([]),w=u([]),V=Y(),b=u([]),t=u({dateRange:V,playerIds:[],profession:null}),A=x(()=>t.value.profession?w.value.filter(e=>e.profession===t.value.profession).sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})):w.value.sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`}))),B=x(()=>{if(!y.value)return[];let e=[];return y.value.forEach(a=>{a.data.forEach(o=>{const n=`${o.id}:${o.profession}`,l=!t.value.profession||o.profession===t.value.profession,c=t.value.playerIds.length===0||t.value.playerIds.includes(n);l&&c&&e.push({key:`${a.date}-${n}`,date:a.date,...o})})}),e.sort((a,o)=>new Date(o.date).getTime()-new Date(a.date).getTime()),e});P(()=>t.value.profession,()=>{t.value.playerIds=[]});const E=()=>{if(!y.value)return;const e=new Set,a=new Set,o=[];y.value.forEach(n=>{n.data.forEach(l=>{e.add(l.profession);const c=`${l.id}:${l.profession}`;a.has(c)||(a.add(c),o.push({id:l.id,profession:l.profession}))})}),k.value=Array.from(e).sort().map(n=>({label:n,value:n})),w.value=o},$=()=>{r.value=!0;try{const e=D.filterAllPlayerDateData({dateRange:t.value.dateRange,playerIds:[],profession:null});y.value=e,E()}catch(e){console.error("加载数据失败:",e),S.error("加载数据失败")}finally{r.value=!1}},z=async()=>{r.value=!0;try{await D.getAllPlayerDateData()}catch(e){console.error("加载数据失败:",e),S.error("加载数据失败")}finally{r.value=!1}};P(()=>t.value.dateRange,()=>{$()}),M(async()=>{await z(),$(),D.getPlayerProfessionData()}),W();const O=e=>{g.value=!0,b.value={date:e.date,score:Number(e.score.toFixed(2)),playerId:e.id,profession:e.profession}},U=e=>{g.value=!1};return(e,a)=>{const o=i("a-typography-title"),n=i("a-range-picker"),l=i("a-select"),c=i("a-space"),G=i("a-Image"),I=i("a-button"),j=i("a-table"),q=i("a-card");return v(),C("div",oe,[H(p(q,{class:"shadow-lg"},{default:f(()=>[p(o,{level:4},{default:f(()=>a[3]||(a[3]=[h("数据明细")])),_:1,__:[3]}),R("div",se,[p(c,null,{default:f(()=>[p(n,{value:t.value.dateRange,"onUpdate:value":a[0]||(a[0]=s=>t.value.dateRange=s),disabled:r.value,style:{width:"280px"}},null,8,["value","disabled"]),p(l,{value:t.value.profession,"onUpdate:value":a[1]||(a[1]=s=>t.value.profession=s),options:k.value,placeholder:"选择职业",disabled:r.value,style:{width:"200px"},"allow-clear":""},null,8,["value","options","disabled"]),p(l,{value:t.value.playerIds,"onUpdate:value":a[2]||(a[2]=s=>t.value.playerIds=s),options:A.value,placeholder:"选择玩家",disabled:r.value,style:{width:"300px"},mode:"multiple","allow-clear":""},null,8,["value","options","disabled"])]),_:1})]),p(j,{columns:N,"data-source":B.value,loading:r.value,pagination:{showSizeChanger:!0,pageSize:500,pageSizeOptions:["200","400","500","1000"],showTotal:s=>`共 ${s} 条数据`}},{bodyCell:f(({column:s,record:d})=>[s.key==="id"?(v(),C(K,{key:0},[R("span",null,T(d.id),1),d.pin?(v(),m(G,{key:0,width:20,preview:!1,src:F(te)},null,8,["src"])):_("",!0)],64)):_("",!0),s.key==="score"?(v(),m(I,{key:1,style:Q({color:"#fff",background:F(ae)(d.score?d.score.toFixed(2):"")})},{default:f(()=>[h(T(d.score?d.score.toFixed(2):""),1)]),_:2},1032,["style"])):_("",!0),s.key==="action"?(v(),m(I,{key:2,type:"link",onClick:re=>O(d)},{default:f(()=>a[4]||(a[4]=[h(" 查看明细 ")])),_:2,__:[4]},1032,["onClick"])):_("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1},512),[[J,!g.value]]),g.value?(v(),m(ee,{key:0,playerDetailData:b.value,onGoBack:U},null,8,["playerDetailData"])):_("",!0)])}}}),pe=X(le,[["__scopeId","data-v-5020a2e8"]]);export{pe as default};
