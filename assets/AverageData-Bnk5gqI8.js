import{d as z,r as f,c as _,w as E,o as G,a as g,b as $,e as v,f as C,v as H,g as n,h as o,i,j as S,k as D,l as c,F as V,m as q,u as m,n as J,t as y,p as K,q as u,_ as Q}from"./index-Dfc2fAFg.js";import{a as W,g as X,P as Y,V as Z,b as ee}from"./PlayerDetail-DWgzbAtn.js";import{u as ae,p as te}from"./table-mixins-CSWh9fpX.js";const le={class:"data-detail"},oe={class:"mb-4"},se={class:"table-scroll-container"},ne=z({__name:"AverageData",setup(re){const l=W(),{handleSortChange:A}=ae(),B=[{title:"玩家ID",dataIndex:"id",key:"id",width:200,flex:1},{title:"职业",dataIndex:"profession",key:"profession",flex:1,width:60,sorter:(e,a)=>e.profession-a.profession},{title:"平均分",dataIndex:"average",key:"average",width:120,flex:1,sorter:(e,a)=>e.average-a.average},{title:"出场次数",dataIndex:"frequency",key:"frequency",width:120,flex:1,sorter:(e,a)=>e.frequency-a.frequency},{title:"操作",key:"action",width:120}],r=f(!1),p=f(!1),N=X(),h=f([]),s=f({dateRange:N,playerIds:[],profession:null}),w=_(()=>l.professionNameList),b=_(()=>s.value.profession?l.uniquePlayerProfessions.filter(e=>e.profession===s.value.profession):l.uniquePlayerProfessions),O=_(()=>l.filterAverageDateData({playerIds:s.value.playerIds,profession:s.value.profession})),k=(e,a)=>a.label.toLowerCase().indexOf(e.toLowerCase())>=0;E(()=>s.value.profession,()=>{s.value.playerIds=[]});const L=()=>{r.value=!0;try{l.getPlayerProfessionData()}catch(e){console.error("加载数据失败:",e),S.error("加载数据失败")}finally{r.value=!1}},R=async()=>{r.value=!0;try{await l.getAllPlayerDateData()}catch(e){console.error("加载数据失败:",e),S.error("加载数据失败")}finally{r.value=!1}};G(async()=>{(!l.allPlayerData||l.allPlayerData.length===0)&&(await R(),l.getPlayerProfessionData()),console.log("allPlayerDataStore",l),L()}),K();const T=e=>{p.value=!0;const a=l.getPlayerAvailableDates(e.id,e.profession);let d=l.getSpecificPlayerDataByDate(e.id,e.profession,a[a.length-1]);console.log("handleViewDetail",d,a,e),h.value={date:d.date,score:d.score,playerId:e.id,profession:e.profession}},F=e=>{p.value=!1};return(e,a)=>{const d=i("a-typography-title"),P=i("a-select-option"),x=i("a-select"),M=i("a-space"),U=i("a-Image"),I=i("a-button"),j=i("a-card");return u(),g("div",le,[$(n(j,{class:"shadow-lg card-container"},{default:o(()=>[n(d,{level:4},{default:o(()=>a[2]||(a[2]=[c("历史平均分排名")])),_:1,__:[2]}),D("div",oe,[n(M,null,{default:o(()=>[n(x,{value:s.value.profession,"onUpdate:value":a[0]||(a[0]=t=>s.value.profession=t),options:w.value,placeholder:"选择职业",disabled:r.value,style:{width:"200px"},"allow-clear":"","show-search":"","filter-option":k},{default:o(()=>[(u(!0),g(V,null,q(w.value,t=>(u(),v(P,{key:t.value,value:t.value},{default:o(()=>[c(y(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","options","disabled"]),n(x,{value:s.value.playerIds,"onUpdate:value":a[1]||(a[1]=t=>s.value.playerIds=t),options:b.value,placeholder:"选择玩家",disabled:r.value,style:{width:"300px"},mode:"multiple","allow-clear":"","show-search":"","filter-option":k},{default:o(()=>[(u(!0),g(V,null,q(b.value,t=>(u(),v(P,{key:t.value,value:t.value},{default:o(()=>[c(y(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","options","disabled"])]),_:1})]),D("div",se,[n(Z,{data:O.value,columns:B,"body-height":800,onSortChange:m(A),loading:r.value},{"cell-id":o(({row:t})=>[D("span",null,y(t.id),1),t.pin?(u(),v(U,{key:0,width:20,preview:!1,src:m(te)},null,8,["src"])):C("",!0)]),"cell-average":o(({row:t})=>[n(I,{style:J({color:"#fff",background:m(ee)(t.average)})},{default:o(()=>[c(y(t.average),1)]),_:2},1032,["style"])]),"cell-action":o(({row:t})=>[n(I,{type:"link",onClick:ie=>T(t)},{default:o(()=>a[3]||(a[3]=[c(" 查看明细 ")])),_:2,__:[3]},1032,["onClick"])]),_:1},8,["data","onSortChange","loading"])])]),_:1},512),[[H,!p.value]]),p.value?(u(),v(Y,{key:0,playerDetailData:h.value,onGoBack:F},null,8,["playerDetailData"])):C("",!0)])}}}),pe=Q(ne,[["__scopeId","data-v-f74f3e31"]]);export{pe as default};
