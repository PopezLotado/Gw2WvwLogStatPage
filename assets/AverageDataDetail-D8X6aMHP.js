import{d as j,r as u,c as k,w as I,o as z,a as F,b as G,e as x,f as S,v as L,g as r,h as i,i as p,j as $,k as g,l as D,u as _,n as H,t as C,m as J,p as h,_ as K}from"./index-st8wcS5Z.js";import{a as Q,g as W,P as X,V as Y,b as Z}from"./PlayerDetail-pC_RbTUD.js";import{u as ee,p as ae}from"./table-mixins-BH9yXgeD.js";const te={class:"data-detail"},le={class:"mb-4"},oe={class:"table-scroll-container"},se=j({__name:"AverageDataDetail",setup(ne){const n=Q(),{handleSortChange:V}=ee(),A=[{title:"玩家ID",dataIndex:"id",key:"id",width:200,flex:1},{title:"职业",dataIndex:"profession",key:"profession",flex:1,width:60,sorter:(e,a)=>e.profession-a.profession},{title:"平均分",dataIndex:"average",key:"average",width:120,flex:1,sorter:(e,a)=>e.average-a.average},{title:"出场次数",dataIndex:"frequency",key:"frequency",width:120,flex:1,sorter:(e,a)=>e.frequency-a.frequency},{title:"操作",key:"action",width:120}],d=u(!1),f=u([]),v=u(!1),m=u([]),y=u([]),B=W(),w=u([]),t=u({dateRange:B,playerIds:[],profession:null}),R=k(()=>t.value.profession?y.value.filter(e=>e.profession===t.value.profession).sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})):y.value.sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`}))),T=k(()=>{if(!f.value)return[];let e=[];return f.value.forEach(a=>{const o=`${a.id}:${a.profession}`,l=!t.value.profession||a.profession===t.value.profession,c=t.value.playerIds.length===0||t.value.playerIds.includes(o);l&&c&&e.push({...a})}),e.sort((a,o)=>new Date(o.date).getTime()-new Date(a.date).getTime()),e});I(()=>t.value.profession,()=>{t.value.playerIds=[]});const q=()=>{if(!f.value)return;const e=new Set,a=new Set,o=[];f.value.forEach(l=>{e.add(l.profession);const c=`${l.id}:${l.profession}`;a.has(c)||(a.add(c),o.push({id:l.id,profession:l.profession}))}),m.value=Array.from(e).sort().map(l=>({label:l,value:l})),y.value=o},b=()=>{d.value=!0;try{const e=n.filterAverageDateData({playerIds:t.value.playerIds,profession:t.value.profession});f.value=e,q()}catch(e){console.error("加载数据失败:",e),$.error("加载数据失败")}finally{d.value=!1}},N=async()=>{d.value=!0;try{await n.getAllPlayerDateData()}catch(e){console.error("加载数据失败:",e),$.error("加载数据失败")}finally{d.value=!1}};I(()=>t.value.dateRange,()=>{b()}),z(async()=>{(!n.allPlayerData||n.allPlayerData.length===0)&&(await N(),n.getPlayerProfessionData()),console.log("allPlayerDataStore",n),b()}),J();const E=e=>{v.value=!0;const a=n.getPlayerAvailableDates(e.id,e.profession);let o=n.getSpecificPlayerDataByDate(e.id,e.profession,a[a.length-1]);console.log("handleViewDetail",o,a,e),w.value={date:o.date,score:o.score,playerId:e.id,profession:e.profession}},M=e=>{v.value=!1};return(e,a)=>{const o=p("a-typography-title"),l=p("a-select"),c=p("a-space"),O=p("a-Image"),P=p("a-button"),U=p("a-card");return h(),F("div",te,[G(r(U,{class:"shadow-lg card-container"},{default:i(()=>[r(o,{level:4},{default:i(()=>a[2]||(a[2]=[D("历史平均分排名")])),_:1,__:[2]}),g("div",le,[r(c,null,{default:i(()=>[r(l,{value:t.value.profession,"onUpdate:value":a[0]||(a[0]=s=>t.value.profession=s),options:m.value,placeholder:"选择职业",disabled:d.value,style:{width:"200px"},"allow-clear":""},null,8,["value","options","disabled"]),r(l,{value:t.value.playerIds,"onUpdate:value":a[1]||(a[1]=s=>t.value.playerIds=s),options:R.value,placeholder:"选择玩家",disabled:d.value,style:{width:"300px"},mode:"multiple","allow-clear":""},null,8,["value","options","disabled"])]),_:1})]),g("div",oe,[r(Y,{data:T.value,columns:A,"body-height":800,onSortChange:_(V),loading:d.value},{"cell-id":i(({row:s})=>[g("span",null,C(s.id),1),s.pin?(h(),x(O,{key:0,width:20,preview:!1,src:_(ae)},null,8,["src"])):S("",!0)]),"cell-average":i(({row:s})=>[r(P,{style:H({color:"#fff",background:_(Z)(s.average)})},{default:i(()=>[D(C(s.average),1)]),_:2},1032,["style"])]),"cell-action":i(({row:s})=>[r(P,{type:"link",onClick:re=>E(s)},{default:i(()=>a[3]||(a[3]=[D(" 查看明细 ")])),_:2,__:[3]},1032,["onClick"])]),_:1},8,["data","onSortChange","loading"])])]),_:1},512),[[L,!v.value]]),v.value?(h(),x(X,{key:0,playerDetailData:w.value,onGoBack:M},null,8,["playerDetailData"])):S("",!0)])}}}),ce=K(se,[["__scopeId","data-v-14f27fc6"]]);export{ce as default};
