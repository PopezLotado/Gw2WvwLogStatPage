import{d as U,r as s,c as h,w as z,o as K,a as v,k as b,n as H,F as A,q as $,s as E,p as d,f as W,l as V,t as I,x as M,_ as Y}from"./index-DPoWanjC.js";const ie="/assets/pin-Cs6GTirN.png",q={class:"virtual-table",style:{width:"100%"}},j={class:"header-row",style:{width:"100%"}},J=["onClick"],P={class:"header-content"},Q={key:0,class:"sort-icons"},X={key:0,class:"table-loading"},Z={key:1,class:"table-empty"},ee=["onClick"],te=40,ae=40,le=500,se="#ffffff",oe="#f8fafc",ne=U({__name:"VirtualTable",props:{data:{},columns:{},rowHeight:{},headerHeight:{},bodyHeight:{},rowKey:{},evenRowBg:{},oddRowBg:{},loading:{type:Boolean}},emits:["row-click","sort-change"],setup(O,{emit:D}){const r=O,p=D,k=s(null),C=s(0),y=s(0),_=s(0),x=s(0),T=s(0),i=s(null),o=s(null),m=s([]),l=h(()=>r.rowHeight||te),u=h(()=>r.headerHeight||ae),c=h(()=>r.bodyHeight||le),F=h(()=>r.evenRowBg||se),R=h(()=>r.oddRowBg||oe);h(()=>r.columns.reduce((t,n)=>t+n.width,0));const f=h(()=>m.value.length*l.value),g=h(()=>m.value.slice(y.value,_.value+1)),G=()=>{k.value&&(C.value=k.value.scrollTop,S())},S=()=>{if(m.value.length===0){y.value=0,_.value=0,T.value=0;return}x.value=Math.ceil(c.value/l.value)+2,y.value=Math.floor(C.value/l.value),y.value=Math.max(0,y.value),_.value=y.value+x.value,_.value=Math.min(m.value.length-1,_.value),T.value=y.value*l.value},L=t=>{if(t.sortable===!1)return;const n=t.sortBy||t.key;i.value===n?o.value==="asc"?o.value="desc":o.value==="desc"?(o.value=null,i.value=null):o.value="asc":(i.value=n,o.value="asc"),N(),p("sort-change",i.value,o.value)},N=()=>{if(!i.value||!o.value){m.value=[...r.data];return}const t=r.columns.find(e=>(e.sortBy||e.key)===i.value),n=[...r.data];n.sort((e,w)=>{if(t!=null&&t.sortFn)return t.sortFn(e,w);const a=e[i.value],B=w[i.value];return typeof a=="number"&&typeof B=="number"?a-B:typeof a=="string"&&typeof B=="string"?a.localeCompare(B):a instanceof Date&&B instanceof Date?a.getTime()-B.getTime():String(a).localeCompare(String(B))}),o.value==="desc"&&n.reverse(),m.value=n};return z(()=>[r.data,l.value,c.value],()=>{N(),S()},{deep:!0}),K(()=>{N(),S()}),(t,n)=>(d(),v("div",q,[b("div",{class:"table-header",style:H({height:u.value+"px"})},[b("div",j,[(d(!0),v(A,null,$(t.columns,e=>(d(),v("div",{key:e.key,class:"header-cell",style:H({width:e.width+"px",flex:e.flex?e.flex:"0 0 auto",textAlign:e.align||"left",padding:"0 12px"}),onClick:w=>L(e)},[b("div",P,[E(t.$slots,`header-${e.key}`,{column:e},()=>[V(I(e.title),1)]),e.sortable!==!1?(d(),v("div",Q,[b("span",{class:M(["sort-icon",{active:i.value===e.key&&o.value==="asc"}])},"↑",2),b("span",{class:M(["sort-icon",{active:i.value===e.key&&o.value==="desc"}])},"↓",2)])):W("",!0)])],12,J))),128))])],4),b("div",{class:"table-body",style:H({height:c.value+"px",overflow:"auto"}),onScroll:G,ref_key:"tableBody",ref:k},[t.loading?(d(),v("div",X,[E(t.$slots,"loading",{},()=>[n[0]||(n[0]=b("div",{class:"default-loading"},"加载中...",-1))])])):t.data.length===0?(d(),v("div",Z,[E(t.$slots,"empty",{},()=>[n[1]||(n[1]=b("div",{class:"default-empty"},"暂无数据",-1))])])):(d(),v("div",{key:2,class:"virtual-list",style:H({height:f.value+"px",position:"relative"})},[b("div",{class:"visible-rows",style:H({transform:`translateY(${T.value}px)`,width:"100%"})},[(d(!0),v(A,null,$(g.value,(e,w)=>(d(),v("div",{key:t.rowKey?e[t.rowKey]:w,class:"table-row",style:H({height:l.value+"px",width:"100%",backgroundColor:w%2===0?F.value:R.value}),onClick:a=>t.$emit("row-click",e,w)},[(d(!0),v(A,null,$(t.columns,a=>(d(),v("div",{key:a.key,class:"table-cell",style:H({width:a.width+"px",flex:a.flex?a.flex:"0 0 auto",textAlign:a.align||"left",padding:"0 12px",lineHeight:l.value+"px"})},[E(t.$slots,`cell-${a.key}`,{row:e,column:a,index:w},()=>[V(I(e[a.key]),1)])],4))),128))],12,ee))),128))],4)],4))],36)]))}}),ue=Y(ne,[["__scopeId","data-v-6982e7bd"]]);function ve(O){const D=s([]),r=s(!0),p=s(null),k=s(null),C=s(1e5),y=()=>{loadData()},_=()=>{p.value=null,k.value=null,loadData()},x=(l,u)=>{if(!l||!u){p.value=null,k.value=null;return}p.value=l,k.value=u,T(l,u)},T=(l,u)=>{const c=[...D.value];c.sort((F,R)=>{const f=F[l],g=R[l];return typeof f=="number"&&typeof g=="number"?f-g:typeof f=="string"&&typeof g=="string"?!isNaN(Date.parse(f))&&!isNaN(Date.parse(g))?new Date(f).getTime()-new Date(g).getTime():f.localeCompare(g):f>g?1:f<g?-1:0}),u==="desc"&&c.reverse(),D.value=c},i=h(()=>Math.min(15,D.value.length)),o=h(()=>D.value.length);return{tableData:D,loading:r,sortField:p,sortOrder:k,pageSize:C,refreshData:y,resetSort:_,handleSortChange:x,visibleCount:i,totalCount:o,getSortFieldName:l=>{if(!p.value)return"";const u=l.find(c=>(c.sortBy||c.key)===p.value);return(u==null?void 0:u.title)||p.value}}}export{ue as V,ie as p,ve as u};
