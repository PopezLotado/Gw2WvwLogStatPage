import{u as V,g as z,l as B,H as F,i as L,a as T,b as U,c as j,d as G,e as H}from"./dataLoader-B0bE7IWK.js";import{d as q,r as v,c as k,w as A,a as w,o as J,b as K,e as u,f as b,g as h,h as Q,i as D,j as W,u as X,k as Y,_ as Z}from"./index-BInTf6d7.js";const ee={class:"trend-chart-container"},ae={class:"trend-chart-content"},te={class:"trend-chart-filters"},se={class:"trend-chart-wrapper"},oe=q({__name:"TrendAnalysis",setup(le){V([L,T,U,j,G,H]);const p=v(!1),f=v([]),M=v([]),$=v([]),C=z(),s=v({dateRange:C,playerIds:[],profession:null}),E=k(()=>s.value.profession?$.value.filter(e=>e.profession===s.value.profession).sort((e,t)=>e.id.localeCompare(t.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})):$.value.sort((e,t)=>e.id.localeCompare(t.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})));A(()=>s.value.profession,()=>{s.value.playerIds=[]});const N=()=>{if(!f.value)return;const e=new Set,t=new Set,r=[];f.value.forEach(o=>{o.data.forEach(n=>{e.add(n.profession);const i=`${n.id}:${n.profession}`;t.has(i)||(t.add(i),r.push({id:n.id,profession:n.profession}))})}),M.value=Array.from(e).sort().map(o=>({label:o,value:o})),$.value=r},S=async()=>{p.value=!0;try{const e=await B({dateRange:s.value.dateRange,playerIds:[],profession:null});f.value=e,N()}catch(e){console.error("加载数据失败:",e),Q.error("加载数据失败")}finally{p.value=!1}};A(()=>s.value.dateRange,()=>{S()});const O=k(()=>{if(!f.value||f.value.length===0)return{title:{text:"暂无数据",left:"center",top:"center"}};const e=[...f.value].sort((a,l)=>w(a.date).valueOf()-w(l.date).valueOf()),t=e.map(a=>a.date),r=new Map;e.forEach(a=>{a.data.forEach(l=>{const c=`${l.id}:${l.profession}`;r.has(c)||r.set(c,{id:l.id,profession:l.profession})})});const o=[];if(r.forEach(({id:a,profession:l},c)=>{const y=!s.value.profession||l===s.value.profession,_=s.value.playerIds.length===0||s.value.playerIds.includes(c);if(y&&_){const P=t.map(x=>{const I=e.find(g=>g.date===x);if(!I)return null;const R=I.data.find(g=>`${g.id}:${g.profession}`===c);return R?R.score:null});P.some(x=>x!==null)&&o.push({name:`${a} (${l})`,type:"line",smooth:!0,data:P,symbol:"circle",symbolSize:6,showSymbol:!0,lineStyle:{width:2},areaStyle:{opacity:.1}})}}),o.length===0)return{title:{text:"所选条件下暂无数据",left:"center",top:"center"}};const n=o.flatMap(a=>a.data).filter(a=>a!==null),i=Math.min(...n),m=Math.max(...n),d=(m-i)*.1;return{title:{text:"评分趋势分析",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},formatter:a=>{if(!Array.isArray(a)||a.length===0)return"";let c=`${a[0].axisValue}<br/>`;return a.forEach(y=>{const _=y.value;_!==null&&(c+=`${y.seriesName}: ${Number(_).toFixed(2)}<br/>`)}),c}},legend:{type:"scroll",top:30,data:o.map(a=>a.name)},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0,top:80},xAxis:{type:"category",boundaryGap:!1,data:t,axisLabel:{rotate:45,formatter:a=>w(a).format("MM-DD")}},yAxis:{type:"value",name:"评分",min:Math.max(0,Math.floor(i-d)),max:Math.min(100,Math.ceil(m+d))},series:o.map((a,l)=>({...a,color:`hsl(${l*137.5%360}, 70%, 50%)`}))}});return J(()=>{S()}),(e,t)=>{const r=h("a-typography-title"),o=h("a-range-picker"),n=h("a-select"),i=h("a-space"),m=h("a-card");return Y(),K("div",ee,[u(m,{class:"trend-chart-card","body-style":{padding:"24px",height:"100%"}},{default:b(()=>[D("div",ae,[D("div",te,[u(i,{direction:"vertical",size:"middle",style:{width:"100%"}},{default:b(()=>[u(r,{level:4},{default:b(()=>t[3]||(t[3]=[W("数据筛选")])),_:1,__:[3]}),u(i,null,{default:b(()=>[u(o,{value:s.value.dateRange,"onUpdate:value":t[0]||(t[0]=d=>s.value.dateRange=d),disabled:p.value,style:{width:"280px"}},null,8,["value","disabled"]),u(n,{value:s.value.profession,"onUpdate:value":t[1]||(t[1]=d=>s.value.profession=d),options:M.value,placeholder:"选择职业",disabled:p.value,style:{width:"200px"},"allow-clear":""},null,8,["value","options","disabled"]),u(n,{value:s.value.playerIds,"onUpdate:value":t[2]||(t[2]=d=>s.value.playerIds=d),options:E.value,placeholder:"选择玩家",disabled:p.value,style:{width:"300px"},mode:"multiple","allow-clear":""},null,8,["value","options","disabled"])]),_:1})]),_:1})]),D("div",se,[u(X(F),{class:"trend-chart",option:O.value,loading:p.value,autoresize:""},null,8,["option","loading"])])])]),_:1})])}}}),ie=Z(oe,[["__scopeId","data-v-d9a663c5"]]);export{ie as default};
