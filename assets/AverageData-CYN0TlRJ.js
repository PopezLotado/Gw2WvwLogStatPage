import{d as E,r as f,c as g,w as G,o as H,a as m,b as J,e as v,f as S,v as K,g as s,h as l,i as r,j as V,k as q,l as d,F as A,q as B,u as D,n as Q,t as y,m as W,p as u,_ as X}from"./index-CVXgaf0_.js";import{a as Y,g as Z,P as ee,V as ae,b as te}from"./PlayerDetail-B7bEdQEi.js";import{u as le,p as oe}from"./table-mixins-B_5xG8Bg.js";const se={class:"data-detail"},ne={class:"mb-4"},re={class:"table-scroll-container"},ie=E({__name:"AverageData",setup(ue){const o=Y(),{handleSortChange:N}=le(),O=[{title:"玩家ID",dataIndex:"id",key:"id",width:250,flex:1},{title:"职业",dataIndex:"profession",key:"profession",flex:1,width:100,sorter:(e,a)=>e.profession-a.profession},{title:"平均分",dataIndex:"average",key:"average",width:150,flex:1,sorter:(e,a)=>e.average-a.average},{title:"出场次数",dataIndex:"frequency",key:"frequency",width:150,flex:1,sorter:(e,a)=>e.frequency-a.frequency},{title:"操作",key:"action",width:200}],i=f(!1),p=f(!1),L=Z(),h=f([]),n=f({dateRange:L,playerIds:[],profession:null}),w=g(()=>o.professionNameList),b=g(()=>n.value.profession?o.uniquePlayerProfessions.filter(e=>e.profession===n.value.profession):o.uniquePlayerProfessions),R=g(()=>o.filterAverageDateData({playerIds:n.value.playerIds,profession:n.value.profession})),k=(e,a)=>a.label.toLowerCase().indexOf(e.toLowerCase())>=0;G(()=>n.value.profession,()=>{n.value.playerIds=[]});const T=()=>{i.value=!0;try{o.getPlayerProfessionData()}catch(e){console.error("加载数据失败:",e),V.error("加载数据失败")}finally{i.value=!1}},F=async()=>{i.value=!0;try{await o.getAllPlayerDateData()}catch(e){console.error("加载数据失败:",e),V.error("加载数据失败")}finally{i.value=!1}};H(async()=>{(!o.allPlayerData||o.allPlayerData.length===0)&&(await F(),o.getPlayerProfessionData()),console.log("allPlayerDataStore",o),T()}),W();const x=e=>{p.value=!0;const a=o.getPlayerAvailableDates(e.id,e.profession);let c=o.getSpecificPlayerDataByDate(e.id,e.profession,a[a.length-1]);console.log("handleViewDetail",c,a,e),h.value={date:c.date,score:c.score,playerId:e.id,profession:e.profession}},M=()=>{p.value=!1};return(e,a)=>{const c=r("a-typography-title"),P=r("a-select-option"),I=r("a-select"),C=r("a-col"),U=r("a-row"),_=r("a-button"),$=r("a-Image"),j=r("a-card");return u(),m("div",se,[J(s(j,{class:"shadow-lg card-container"},{default:l(()=>[s(c,{level:4},{default:l(()=>a[2]||(a[2]=[d("历史平均分排名")])),_:1,__:[2]}),q("div",ne,[s(U,{gutter:[16,16],style:{margin:"0 auto 0 0","max-width":"900px"}},{default:l(()=>[s(C,{span:24,xs:24,sm:12,md:8,lg:8},{default:l(()=>[s(I,{value:n.value.profession,"onUpdate:value":a[0]||(a[0]=t=>n.value.profession=t),options:w.value,placeholder:"选择职业",disabled:i.value,style:{width:"100%"},"allow-clear":"","show-search":"","filter-option":k},{default:l(()=>[(u(!0),m(A,null,B(w.value,t=>(u(),v(P,{key:t.value,value:t.value},{default:l(()=>[d(y(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","options","disabled"])]),_:1}),s(C,{span:24,xs:24,sm:12,md:8,lg:8},{default:l(()=>[s(I,{value:n.value.playerIds,"onUpdate:value":a[1]||(a[1]=t=>n.value.playerIds=t),options:b.value,placeholder:"选择玩家",disabled:i.value,style:{width:"100%"},mode:"multiple","allow-clear":"","show-search":"","filter-option":k},{default:l(()=>[(u(!0),m(A,null,B(b.value,t=>(u(),v(P,{key:t.value,value:t.value},{default:l(()=>[d(y(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","options","disabled"])]),_:1})]),_:1})]),q("div",re,[s(ae,{data:R.value,columns:O,"body-height":800,onSortChange:D(N),loading:i.value,scroll:{x:"100%"}},{"cell-id":l(({row:t})=>[s(_,{type:"link",onClick:z=>x(t)},{default:l(()=>[d(y(t.id),1)]),_:2},1032,["onClick"]),t.pin?(u(),v($,{key:0,width:20,preview:!1,src:D(oe)},null,8,["src"])):S("",!0)]),"cell-average":l(({row:t})=>[s(_,{style:Q({color:"#fff",background:D(te)(t.average)})},{default:l(()=>[d(y(t.average),1)]),_:2},1032,["style"])]),"cell-action":l(({row:t})=>[s(_,{type:"link",onClick:z=>x(t)},{default:l(()=>a[3]||(a[3]=[d(" 查看明细 ")])),_:2,__:[3]},1032,["onClick"])]),_:1},8,["data","onSortChange","loading"])])]),_:1},512),[[K,!p.value]]),p.value?(u(),v(ee,{key:0,playerDetailData:h.value,onGoBack:M},null,8,["playerDetailData"])):S("",!0)])}}}),fe=X(ie,[["__scopeId","data-v-4bd85d81"]]);export{fe as default};
