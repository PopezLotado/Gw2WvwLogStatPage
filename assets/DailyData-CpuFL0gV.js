import{d as G,r as p,c as w,w as S,o as H,a as D,b as J,e as m,f as V,v as K,g as s,h as o,i as d,j as T,k as P,l as c,F as $,m as N,u as b,n as Q,t as f,p as W,q as u,_ as X}from"./index-Dfc2fAFg.js";import{a as Y,g as Z,P as ee,V as ae,b as te}from"./PlayerDetail-DWgzbAtn.js";import{u as le,p as oe}from"./table-mixins-CSWh9fpX.js";const ne={class:"data-detail"},se={class:"mb-4"},re={class:"table-scroll-container"},ie=G({__name:"DailyData",setup(de){const n=Y(),{handleSortChange:B}=le(),O=[{title:"日期",dataIndex:"date",key:"date",width:100,sorter:(e,a)=>(console.log(`排序比较: ${e.date} vs ${a.date}`),new Date(a.date).getTime()-new Date(e.date).getTime())},{title:"玩家ID",dataIndex:"id",key:"id",flex:1,width:200},{title:"职业",dataIndex:"profession",key:"profession",flex:1,width:60},{title:"分均倒地（次）",dataIndex:"downPerMinute",key:"downPerMinute",width:100,flex:1,sorter:(e,a)=>e.downPerMinute-a.downPerMinute},{title:"分均死亡率（%）",dataIndex:"deathPerMinute",key:"deathPerMinute",width:100,flex:1,sorter:(e,a)=>e.deathPerMinute-a.deathPerMinute},{title:"战斗时间（s）",dataIndex:"durationInCombat",key:"durationInCombat",width:100,flex:1,sorter:(e,a)=>e.durationInCombat-a.durationInCombat},{title:"评分",dataIndex:"score",key:"score",width:100,flex:1,sorter:(e,a)=>e.score-a.score},{title:"操作",key:"action",width:100}],r=p(!1),g=p([]),v=p(!1),A=Z(),k=p([]),l=p({dateRange:A,playerIds:[],profession:null}),x=w(()=>n.professionNameList),I=w(()=>l.value.profession?n.uniquePlayerProfessions.filter(e=>e.profession===l.value.profession):n.uniquePlayerProfessions),L=w(()=>{if(!g.value)return[];let e=[];return g.value.forEach(a=>{a.data.forEach(i=>{const y=`${i.id}:${i.profession}`,_=!l.value.profession||i.profession===l.value.profession,h=l.value.playerIds.length===0||l.value.playerIds.includes(y);_&&h&&e.push({key:`${a.date}-${y}`,date:a.date,...i})})}),e.sort((a,i)=>new Date(i.date).getTime()-new Date(a.date).getTime()),e}),C=(e,a)=>a.label.toLowerCase().indexOf(e.toLowerCase())>=0;S(()=>l.value.profession,()=>{l.value.playerIds=[]});const M=async()=>{r.value=!0;try{const e=await n.filterAllPlayerDateData({dateRange:l.value.dateRange,playerIds:[],profession:null});g.value=e}catch(e){console.error("加载数据失败:",e),T.error("加载数据失败")}finally{r.value=!1}},q=async()=>{r.value=!0;try{await n.getAllPlayerDateData()}catch(e){console.error("加载数据失败:",e),T.error("加载数据失败")}finally{r.value=!1}};S(()=>l.value.dateRange,()=>{M()}),H(async()=>{(!n.allPlayerData||n.allPlayerData.length===0)&&(await q(),n.getPlayerProfessionData()),M(),console.log("allPlayerDataStore",n)}),W();const E=e=>{v.value=!0,k.value={date:e.date,score:e.score,playerId:e.id,profession:e.profession}},F=e=>{v.value=!1};return(e,a)=>{const i=d("a-typography-title"),y=d("a-range-picker"),_=d("a-select-option"),h=d("a-select"),U=d("a-space"),j=d("a-Image"),R=d("a-button"),z=d("a-card");return u(),D("div",ne,[J(s(z,{class:"shadow-lg card-container"},{default:o(()=>[s(i,{level:4},{default:o(()=>a[3]||(a[3]=[c("每日数据明细")])),_:1,__:[3]}),P("div",se,[s(U,null,{default:o(()=>[s(y,{value:l.value.dateRange,"onUpdate:value":a[0]||(a[0]=t=>l.value.dateRange=t),disabled:r.value,style:{width:"280px"}},null,8,["value","disabled"]),s(h,{value:l.value.profession,"onUpdate:value":a[1]||(a[1]=t=>l.value.profession=t),options:x.value,placeholder:"选择职业",disabled:r.value,style:{width:"200px"},"allow-clear":"","show-search":"","filter-option":C},{default:o(()=>[(u(!0),D($,null,N(x.value,t=>(u(),m(_,{key:t.value,value:t.value},{default:o(()=>[c(f(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","options","disabled"]),s(h,{value:l.value.playerIds,"onUpdate:value":a[2]||(a[2]=t=>l.value.playerIds=t),options:I.value,placeholder:"选择玩家",disabled:r.value,style:{width:"300px"},mode:"multiple","allow-clear":"","show-search":"","filter-option":C},{default:o(()=>[(u(!0),D($,null,N(I.value,t=>(u(),m(_,{key:t.value,value:t.value},{default:o(()=>[c(f(t.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","options","disabled"])]),_:1})]),P("div",re,[s(ae,{data:L.value,columns:O,"body-height":800,onSortChange:b(B),loading:r.value},{"cell-id":o(({row:t})=>[P("span",null,f(t.id),1),t.pin?(u(),m(j,{key:0,width:20,preview:!1,src:b(oe)},null,8,["src"])):V("",!0)]),"cell-deathPerMinute":o(({row:t})=>[c(f(t.deathPerMinute?Number((t.deathPerMinute*100).toFixed(2)):t.deathPerMinute===0?0:""),1)]),"cell-score":o(({row:t})=>[s(R,{style:Q({color:"#fff",background:b(te)(t.score)})},{default:o(()=>[c(f(t.score),1)]),_:2},1032,["style"])]),"cell-action":o(({row:t})=>[s(R,{type:"link",onClick:ue=>E(t)},{default:o(()=>a[4]||(a[4]=[c(" 查看明细 ")])),_:2,__:[4]},1032,["onClick"])]),_:1},8,["data","onSortChange","loading"])])]),_:1},512),[[K,!v.value]]),v.value?(u(),m(ee,{key:0,playerDetailData:k.value,onGoBack:F},null,8,["playerDetailData"])):V("",!0)])}}}),ve=X(ie,[["__scopeId","data-v-42248971"]]);export{ve as default};
