import{d as j,r as c,c as _,w as k,o as z,a as F,b as G,e as C,f as M,v as H,g as o,h as s,i as d,j as R,k as h,l as y,u as g,n as J,t as w,m as K,p as D,_ as Q}from"./index-Cqc9S1Tc.js";import{a as W,g as X,P as Y,V as Z,b as ee}from"./PlayerDetail-BRicaQ7h.js";import{u as ae,p as te}from"./table-mixins-B2HbkSx7.js";const le={class:"data-detail"},oe={class:"mb-4"},se={class:"table-scroll-container"},ne=j({__name:"DailyData",setup(re){const n=W(),{handleSortChange:S}=ae(),V=[{title:"日期",dataIndex:"date",key:"date",width:100,sorter:(e,a)=>(console.log(`排序比较: ${e.date} vs ${a.date}`),new Date(a.date).getTime()-new Date(e.date).getTime())},{title:"玩家ID",dataIndex:"id",key:"id",flex:1,width:200},{title:"职业",dataIndex:"profession",key:"profession",flex:1,width:60},{title:"分均倒地（次）",dataIndex:"downPerMinute",key:"downPerMinute",width:100,flex:1,sorter:(e,a)=>e.downPerMinute-a.downPerMinute},{title:"分均死亡率（%）",dataIndex:"deathPerMinute",key:"deathPerMinute",width:100,flex:1,sorter:(e,a)=>e.deathPerMinute-a.deathPerMinute},{title:"战斗时间（s）",dataIndex:"durationInCombat",key:"durationInCombat",width:100,flex:1,sorter:(e,a)=>e.durationInCombat-a.durationInCombat},{title:"评分",dataIndex:"score",key:"score",width:100,flex:1,sorter:(e,a)=>e.score-a.score},{title:"操作",key:"action",width:100}],r=c(!1),m=c([]),p=c(!1),T=X(),P=c([]),l=c({dateRange:T,playerIds:[],profession:null}),$=_(()=>n.professionNameList),N=_(()=>l.value.profession?n.uniquePlayerProfessions.filter(e=>e.profession===l.value.profession):n.uniquePlayerProfessions),B=_(()=>{if(!m.value)return[];let e=[];return m.value.forEach(a=>{a.data.forEach(i=>{const f=`${i.id}:${i.profession}`,u=!l.value.profession||i.profession===l.value.profession,v=l.value.playerIds.length===0||l.value.playerIds.includes(f);u&&v&&e.push({key:`${a.date}-${f}`,date:a.date,...i})})}),e.sort((a,i)=>new Date(i.date).getTime()-new Date(a.date).getTime()),e}),x=(e,a)=>a.label.toLowerCase().indexOf(e.toLowerCase())>=0;k(()=>l.value.profession,()=>{l.value.playerIds=[]});const I=async()=>{r.value=!0;try{const e=await n.filterAllPlayerDateData({dateRange:l.value.dateRange,playerIds:[],profession:null});m.value=e}catch(e){console.error("加载数据失败:",e),R.error("加载数据失败")}finally{r.value=!1}},O=async()=>{r.value=!0;try{await n.getAllPlayerDateData()}catch(e){console.error("加载数据失败:",e),R.error("加载数据失败")}finally{r.value=!1}};k(()=>l.value.dateRange,()=>{I()}),z(async()=>{(!n.allPlayerData||n.allPlayerData.length===0)&&(await O(),n.getPlayerProfessionData()),I(),console.log("allPlayerDataStore",n)}),K();const A=e=>{p.value=!0,P.value={date:e.date,score:e.score,playerId:e.id,profession:e.profession}},E=e=>{p.value=!1};return(e,a)=>{const i=d("a-typography-title"),f=d("a-range-picker"),u=d("a-col"),v=d("a-select"),L=d("a-row"),U=d("a-Image"),b=d("a-button"),q=d("a-card");return D(),F("div",le,[G(o(q,{class:"shadow-lg card-container"},{default:s(()=>[o(i,{level:4},{default:s(()=>a[3]||(a[3]=[y("每日数据明细")])),_:1,__:[3]}),h("div",oe,[o(L,{gutter:[16,16],style:{margin:"0px auto 0 0","max-width":"900px"}},{default:s(()=>[o(u,{span:24,xs:24,sm:12,md:8,lg:8},{default:s(()=>[o(f,{value:l.value.dateRange,"onUpdate:value":a[0]||(a[0]=t=>l.value.dateRange=t),disabled:r.value,style:{width:"100%"}},null,8,["value","disabled"])]),_:1}),o(u,{span:24,xs:24,sm:12,md:8,lg:8},{default:s(()=>[o(v,{value:l.value.profession,"onUpdate:value":a[1]||(a[1]=t=>l.value.profession=t),options:$.value,placeholder:"选择职业",disabled:r.value,style:{width:"100%"},"allow-clear":"","show-search":"","filter-option":x},null,8,["value","options","disabled"])]),_:1}),o(u,{span:24,xs:24,sm:12,md:8,lg:8},{default:s(()=>[o(v,{value:l.value.playerIds,"onUpdate:value":a[2]||(a[2]=t=>l.value.playerIds=t),options:N.value,placeholder:"选择玩家",disabled:r.value,style:{width:"100%"},mode:"multiple","allow-clear":"","show-search":"","filter-option":x},null,8,["value","options","disabled"])]),_:1})]),_:1})]),h("div",se,[o(Z,{data:B.value,columns:V,"body-height":800,onSortChange:g(S),loading:r.value,scroll:{x:"100%"}},{"cell-id":s(({row:t})=>[h("span",null,w(t.id),1),t.pin?(D(),C(U,{key:0,width:20,preview:!1,src:g(te)},null,8,["src"])):M("",!0)]),"cell-deathPerMinute":s(({row:t})=>[y(w(t.deathPerMinute?Number((t.deathPerMinute*100).toFixed(2)):t.deathPerMinute===0?0:""),1)]),"cell-score":s(({row:t})=>[o(b,{style:J({color:"#fff",background:g(ee)(t.score)})},{default:s(()=>[y(w(t.score),1)]),_:2},1032,["style"])]),"cell-action":s(({row:t})=>[o(b,{type:"link",onClick:ie=>A(t)},{default:s(()=>a[4]||(a[4]=[y(" 查看明细 ")])),_:2,__:[4]},1032,["onClick"])]),_:1},8,["data","onSortChange","loading"])])]),_:1},512),[[H,!p.value]]),p.value?(D(),C(Y,{key:0,playerDetailData:P.value,onGoBack:E},null,8,["playerDetailData"])):M("",!0)])}}}),pe=Q(ne,[["__scopeId","data-v-3384ee80"]]);export{pe as default};
