import{d as j,r as i,c as b,w as x,o as A,b as T,l as $,v as I,e as r,f as c,g as d,h as q,i as G,j as m,m as C,n as P,t as L,p as M,u as H,a as S,q as J,k as g,_ as K}from"./index-gbjd_Yde.js";import{g as Q,l as W}from"./dataLoader-DPSVNHF8.js";import{P as X,g as Y}from"./PlayerDetail-Bp0VB52N.js";import"./install-GW2X08h3.js";const Z={class:"data-detail"},ee={class:"mb-4"},ae=j({__name:"DataDetail",setup(oe){const R=[{title:"日期",dataIndex:"date",key:"date",width:120,sorter:(e,a)=>S(e.date).valueOf()-S(a.date).valueOf()},{title:"玩家ID",dataIndex:"id",key:"id",width:200},{title:"职业",dataIndex:"profession",key:"profession",width:120},{title:"评分",dataIndex:"score",key:"score",width:120,sorter:(e,a)=>e.score-a.score},{title:"操作",key:"action",width:120,fixed:"right"}],u=i(!1),f=i([]),v=i(!1),h=i([]),y=i([]),V=Q(),w=i([]),o=i({dateRange:V,playerIds:[],profession:null}),B=b(()=>o.value.profession?y.value.filter(e=>e.profession===o.value.profession).sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})):y.value.sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`}))),E=b(()=>{if(!f.value)return[];let e=[];return f.value.forEach(a=>{a.data.forEach(l=>{const n=`${l.id}:${l.profession}`,t=!o.value.profession||l.profession===o.value.profession,p=o.value.playerIds.length===0||o.value.playerIds.includes(n);t&&p&&e.push({key:`${a.date}-${n}`,date:a.date,...l})})}),e});x(()=>o.value.profession,()=>{o.value.playerIds=[]});const F=()=>{if(!f.value)return;const e=new Set,a=new Set,l=[];f.value.forEach(n=>{n.data.forEach(t=>{e.add(t.profession);const p=`${t.id}:${t.profession}`;a.has(p)||(a.add(p),l.push({id:t.id,profession:t.profession}))})}),h.value=Array.from(e).sort().map(n=>({label:n,value:n})),y.value=l},k=async()=>{u.value=!0;try{const e=await W({dateRange:o.value.dateRange,playerIds:[],profession:null});f.value=e,F()}catch(e){console.error("加载数据失败:",e),q.error("加载数据失败")}finally{u.value=!1}};x(()=>o.value.dateRange,()=>{k()}),A(()=>{k()}),J();const N=e=>{v.value=!0,w.value={date:e.date,score:Number(e.score.toFixed(2)),playerId:e.id,profession:e.profession}},O=e=>{v.value=!1};return(e,a)=>{const l=d("a-typography-title"),n=d("a-range-picker"),t=d("a-select"),p=d("a-space"),D=d("a-button"),z=d("a-table"),U=d("a-card");return g(),T("div",Z,[$(r(U,{class:"shadow-lg"},{default:c(()=>[r(l,{level:4},{default:c(()=>a[3]||(a[3]=[m("数据明细")])),_:1,__:[3]}),G("div",ee,[r(p,null,{default:c(()=>[r(n,{value:o.value.dateRange,"onUpdate:value":a[0]||(a[0]=s=>o.value.dateRange=s),disabled:u.value,style:{width:"280px"}},null,8,["value","disabled"]),r(t,{value:o.value.profession,"onUpdate:value":a[1]||(a[1]=s=>o.value.profession=s),options:h.value,placeholder:"选择职业",disabled:u.value,style:{width:"200px"},"allow-clear":""},null,8,["value","options","disabled"]),r(t,{value:o.value.playerIds,"onUpdate:value":a[2]||(a[2]=s=>o.value.playerIds=s),options:B.value,placeholder:"选择玩家",disabled:u.value,style:{width:"300px"},mode:"multiple","allow-clear":""},null,8,["value","options","disabled"])]),_:1})]),r(z,{columns:R,"data-source":E.value,loading:u.value,pagination:{showSizeChanger:!0,pageSize:500,pageSizeOptions:["200","400","500","1000"],showTotal:s=>`共 ${s} 条数据`}},{bodyCell:c(({column:s,record:_})=>[s.key==="score"?(g(),C(D,{key:0,style:M({color:"#fff",background:H(Y)(_.score.toFixed(2))})},{default:c(()=>[m(L(_.score.toFixed(2)),1)]),_:2},1032,["style"])):P("",!0),s.key==="action"?(g(),C(D,{key:1,type:"link",onClick:te=>N(_)},{default:c(()=>a[4]||(a[4]=[m(" 查看明细 ")])),_:2,__:[4]},1032,["onClick"])):P("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1},512),[[I,!v.value]]),$(r(X,{playerDetailData:w.value,onGoBack:O},null,8,["playerDetailData"]),[[I,v.value]])])}}}),ie=K(ae,[["__scopeId","data-v-8338e68d"]]);export{ie as default};
