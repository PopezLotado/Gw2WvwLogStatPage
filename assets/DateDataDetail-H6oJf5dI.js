import{d as G,r as u,c as P,w as C,o as L,b as S,l as M,m,n as _,v as H,e as p,f,g as i,h as R,i as h,j as k,F as J,t as F,u as T,p as Q,q as W,k as v,_ as X}from"./index-BT0ZxOep.js";import{g as Y}from"./dataLoader-T7pOHmCJ.js";import{a as Z,P as ee,g as ae}from"./PlayerDetail-zP4LQk8x.js";import{p as te}from"./pin-NTqfuLeK.js";const oe={class:"data-detail"},se={class:"mb-4"},le={class:"table-scroll-container"},ne=G({__name:"DateDataDetail",setup(re){const D=Z(),V=[{title:"日期",dataIndex:"date",key:"date",width:120,sorter:(e,a)=>(console.log(`排序比较: ${e.date} vs ${a.date}`),new Date(a.date).getTime()-new Date(e.date).getTime())},{title:"玩家ID",dataIndex:"id",key:"id",width:200},{title:"职业",dataIndex:"profession",key:"profession",width:120},{title:"评分",dataIndex:"score",key:"score",width:120,sorter:(e,a)=>e.score-a.score},{title:"操作",key:"action",width:120}],r=u(!1),y=u([]),g=u(!1),b=u([]),w=u([]),A=Y(),$=u([]),t=u({dateRange:A,playerIds:[],profession:null}),B=P(()=>t.value.profession?w.value.filter(e=>e.profession===t.value.profession).sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})):w.value.sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`}))),E=P(()=>{if(!y.value)return[];let e=[];return y.value.forEach(a=>{a.data.forEach(s=>{const n=`${s.id}:${s.profession}`,l=!t.value.profession||s.profession===t.value.profession,c=t.value.playerIds.length===0||t.value.playerIds.includes(n);l&&c&&e.push({key:`${a.date}-${n}`,date:a.date,...s})})}),e.sort((a,s)=>new Date(s.date).getTime()-new Date(a.date).getTime()),e});C(()=>t.value.profession,()=>{t.value.playerIds=[]});const N=()=>{if(!y.value)return;const e=new Set,a=new Set,s=[];y.value.forEach(n=>{n.data.forEach(l=>{e.add(l.profession);const c=`${l.id}:${l.profession}`;a.has(c)||(a.add(c),s.push({id:l.id,profession:l.profession}))})}),b.value=Array.from(e).sort().map(n=>({label:n,value:n})),w.value=s},I=()=>{r.value=!0;try{const e=D.filterAllPlayerDateData({dateRange:t.value.dateRange,playerIds:[],profession:null});y.value=e,N()}catch(e){console.error("加载数据失败:",e),R.error("加载数据失败")}finally{r.value=!1}},z=async()=>{r.value=!0;try{await D.getAllPlayerDateData()}catch(e){console.error("加载数据失败:",e),R.error("加载数据失败")}finally{r.value=!1}};C(()=>t.value.dateRange,()=>{I()}),L(async()=>{await z(),I(),D.getPlayerProfessionData()}),W();const O=e=>{g.value=!0,$.value={date:e.date,score:Number(e.score.toFixed(2)),playerId:e.id,profession:e.profession}},U=e=>{g.value=!1};return(e,a)=>{const s=i("a-typography-title"),n=i("a-range-picker"),l=i("a-select"),c=i("a-space"),K=i("a-Image"),x=i("a-button"),j=i("a-table"),q=i("a-card");return v(),S("div",oe,[M(p(q,{class:"shadow-lg card-container"},{default:f(()=>[p(s,{level:4},{default:f(()=>a[3]||(a[3]=[k("每日数据明细")])),_:1,__:[3]}),h("div",se,[p(c,null,{default:f(()=>[p(n,{value:t.value.dateRange,"onUpdate:value":a[0]||(a[0]=o=>t.value.dateRange=o),disabled:r.value,style:{width:"280px"}},null,8,["value","disabled"]),p(l,{value:t.value.profession,"onUpdate:value":a[1]||(a[1]=o=>t.value.profession=o),options:b.value,placeholder:"选择职业",disabled:r.value,style:{width:"200px"},"allow-clear":""},null,8,["value","options","disabled"]),p(l,{value:t.value.playerIds,"onUpdate:value":a[2]||(a[2]=o=>t.value.playerIds=o),options:B.value,placeholder:"选择玩家",disabled:r.value,style:{width:"300px"},mode:"multiple","allow-clear":""},null,8,["value","options","disabled"])]),_:1})]),h("div",le,[p(j,{columns:V,"data-source":E.value,loading:r.value,scroll:{x:"100%",y:650},virtual:"",rowKey:o=>o.date+o.id+o.profession,pagination:{showSizeChanger:!0,pageSize:1e3,pageSizeOptions:["100","200","500","1000"],showTotal:o=>`共 ${o} 条数据`,position:["bottomRight"]}},{bodyCell:f(({column:o,record:d})=>[o.key==="id"?(v(),S(J,{key:0},[h("span",null,F(d.id),1),d.pin?(v(),m(K,{key:0,width:20,preview:!1,src:T(te)},null,8,["src"])):_("",!0)],64)):_("",!0),o.key==="score"?(v(),m(x,{key:1,style:Q({color:"#fff",background:T(ae)(d.score?d.score.toFixed(2):"")})},{default:f(()=>[k(F(d.score?d.score.toFixed(2):""),1)]),_:2},1032,["style"])):_("",!0),o.key==="action"?(v(),m(x,{key:2,type:"link",onClick:ie=>O(d)},{default:f(()=>a[4]||(a[4]=[k(" 查看明细 ")])),_:2,__:[4]},1032,["onClick"])):_("",!0)]),_:1},8,["data-source","loading","rowKey","pagination"])])]),_:1},512),[[H,!g.value]]),g.value?(v(),m(ee,{key:0,playerDetailData:$.value,onGoBack:U},null,8,["playerDetailData"])):_("",!0)])}}}),fe=X(ne,[["__scopeId","data-v-4421086e"]]);export{fe as default};
