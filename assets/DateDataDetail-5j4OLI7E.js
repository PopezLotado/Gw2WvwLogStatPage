import{d as q,r as u,c as x,w as $,o as z,b as G,l as L,m as C,n as M,v as H,e as r,f as i,g as c,h as S,i as _,j as m,u as g,p as J,t as D,q as K,k as w,_ as Q}from"./index-BRm5aUd3.js";import{g as W}from"./dataLoader-BLB9NK00.js";import{a as X,P as Y,g as Z}from"./PlayerDetail-mrekznnA.js";import{p as ee}from"./pin-NTqfuLeK.js";import{u as ae,V as te}from"./table-mixins-DtHnDIE4.js";const oe={class:"data-detail"},le={class:"mb-4"},se={class:"table-scroll-container"},ne=q({__name:"DateDataDetail",setup(re){const p=X(),{handleSortChange:R}=ae(),V=[{title:"日期",dataIndex:"date",key:"date",width:100,sorter:(e,a)=>(console.log(`排序比较: ${e.date} vs ${a.date}`),new Date(a.date).getTime()-new Date(e.date).getTime())},{title:"玩家ID",dataIndex:"id",key:"id",flex:1,width:200},{title:"职业",dataIndex:"profession",key:"profession",flex:1,width:60},{title:"分均倒地（次）",dataIndex:"downPerMinute",key:"downPerMinute",width:100,flex:1,sorter:(e,a)=>e.downPerMinute-a.downPerMinute},{title:"分均死亡率（%）",dataIndex:"deathPerMinute",key:"deathPerMinute",width:100,flex:1,sorter:(e,a)=>e.deathPerMinute-a.deathPerMinute},{title:"战斗时间（s）",dataIndex:"durationInCombat",key:"durationInCombat",width:100,flex:1,sorter:(e,a)=>e.durationInCombat-a.durationInCombat},{title:"评分",dataIndex:"score",key:"score",width:100,flex:1,sorter:(e,a)=>e.score-a.score},{title:"操作",key:"action",width:100}],d=u(!1),v=u([]),y=u(!1),P=u([]),h=u([]),T=W(),b=u([]),o=u({dateRange:T,playerIds:[],profession:null}),A=x(()=>o.value.profession?h.value.filter(e=>e.profession===o.value.profession).sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})):h.value.sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`}))),B=x(()=>{if(!v.value)return[];let e=[];return v.value.forEach(a=>{a.data.forEach(l=>{const n=`${l.id}:${l.profession}`,s=!o.value.profession||l.profession===o.value.profession,f=o.value.playerIds.length===0||o.value.playerIds.includes(n);s&&f&&e.push({key:`${a.date}-${n}`,date:a.date,...l})})}),e.sort((a,l)=>new Date(l.date).getTime()-new Date(a.date).getTime()),e});$(()=>o.value.profession,()=>{o.value.playerIds=[]});const E=()=>{if(!v.value)return;const e=new Set,a=new Set,l=[];v.value.forEach(n=>{n.data.forEach(s=>{e.add(s.profession);const f=`${s.id}:${s.profession}`;a.has(f)||(a.add(f),l.push({id:s.id,profession:s.profession}))})}),P.value=Array.from(e).sort().map(n=>({label:n,value:n})),h.value=l},k=()=>{d.value=!0;try{const e=p.filterAllPlayerDateData({dateRange:o.value.dateRange,playerIds:[],profession:null});v.value=e,E()}catch(e){console.error("加载数据失败:",e),S.error("加载数据失败")}finally{d.value=!1}},N=async()=>{d.value=!0;try{await p.getAllPlayerDateData()}catch(e){console.error("加载数据失败:",e),S.error("加载数据失败")}finally{d.value=!1}};$(()=>o.value.dateRange,()=>{k()}),z(async()=>{(!p.allPlayerData||p.allPlayerData.length===0)&&(await N(),p.getPlayerProfessionData()),k(),console.log("allPlayerDataStore",p)}),K();const U=e=>{y.value=!0,b.value={date:e.date,score:e.score,playerId:e.id,profession:e.profession}},F=e=>{y.value=!1};return(e,a)=>{const l=c("a-typography-title"),n=c("a-range-picker"),s=c("a-select"),f=c("a-space"),O=c("a-Image"),I=c("a-button"),j=c("a-card");return w(),G("div",oe,[L(r(j,{class:"shadow-lg card-container"},{default:i(()=>[r(l,{level:4},{default:i(()=>a[3]||(a[3]=[m("每日数据明细")])),_:1,__:[3]}),_("div",le,[r(f,null,{default:i(()=>[r(n,{value:o.value.dateRange,"onUpdate:value":a[0]||(a[0]=t=>o.value.dateRange=t),disabled:d.value,style:{width:"280px"}},null,8,["value","disabled"]),r(s,{value:o.value.profession,"onUpdate:value":a[1]||(a[1]=t=>o.value.profession=t),options:P.value,placeholder:"选择职业",disabled:d.value,style:{width:"200px"},"allow-clear":""},null,8,["value","options","disabled"]),r(s,{value:o.value.playerIds,"onUpdate:value":a[2]||(a[2]=t=>o.value.playerIds=t),options:A.value,placeholder:"选择玩家",disabled:d.value,style:{width:"300px"},mode:"multiple","allow-clear":""},null,8,["value","options","disabled"])]),_:1})]),_("div",se,[r(te,{data:B.value,columns:V,"body-height":600,onSortChange:g(R),loading:d.value},{"cell-id":i(({row:t})=>[_("span",null,D(t.id),1),t.pin?(w(),C(O,{key:0,width:20,preview:!1,src:g(ee)},null,8,["src"])):M("",!0)]),"cell-deathPerMinute":i(({row:t})=>[m(D(t.deathPerMinute?Number((t.deathPerMinute*100).toFixed(2)):t.deathPerMinute===0?0:""),1)]),"cell-score":i(({row:t})=>[r(I,{style:J({color:"#fff",background:g(Z)(t.score)})},{default:i(()=>[m(D(t.score),1)]),_:2},1032,["style"])]),"cell-action":i(({row:t})=>[r(I,{type:"link",onClick:ie=>U(t)},{default:i(()=>a[4]||(a[4]=[m(" 查看明细 ")])),_:2,__:[4]},1032,["onClick"])]),_:1},8,["data","onSortChange","loading"])])]),_:1},512),[[H,!y.value]]),y.value?(w(),C(Y,{key:0,playerDetailData:b.value,onGoBack:F},null,8,["playerDetailData"])):M("",!0)])}}}),ve=Q(ne,[["__scopeId","data-v-9e4f86e2"]]);export{ve as default};
