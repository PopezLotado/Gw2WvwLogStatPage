import{d as U,r as n,c as k,w as I,o as j,b as P,l as G,m as D,n as g,v as L,e as c,f as v,g as i,h as $,i as h,j as x,F as M,t as S,u as C,p as H,q as J,k as y,_ as Q}from"./index-DhfY9v46.js";import{g as W}from"./dataLoader-f47skL6s.js";import{a as X,P as Y,g as Z}from"./PlayerDetail-BUd7PDz1.js";import{p as ee}from"./pin-NTqfuLeK.js";const ae={class:"data-detail"},oe={class:"mb-4"},te={class:"table-scroll-container"},se=U({__name:"AverageDataDetail",setup(le){const u=X(),A=[{title:"玩家ID",dataIndex:"id",key:"id",width:200},{title:"职业",dataIndex:"profession",key:"profession",width:120,sorter:(e,a)=>e.profession-a.profession},{title:"平均分",dataIndex:"average",key:"average",width:120,sorter:(e,a)=>e.average-a.average},{title:"出场次数",dataIndex:"frequency",key:"frequency",width:120,sorter:(e,a)=>e.frequency-a.frequency}],r=n(!1),f=n([]),_=n(!1),w=n([]),m=n([]),R=W(),q=n([]),o=n({dateRange:R,playerIds:[],profession:null}),B=k(()=>o.value.profession?m.value.filter(e=>e.profession===o.value.profession).sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})):m.value.sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`}))),V=k(()=>{if(!f.value)return[];let e=[];return f.value.forEach(a=>{const l=`${a.id}:${a.profession}`,t=!o.value.profession||a.profession===o.value.profession,d=o.value.playerIds.length===0||o.value.playerIds.includes(l);t&&d&&e.push({...a})}),e.sort((a,l)=>new Date(l.date).getTime()-new Date(a.date).getTime()),e});I(()=>o.value.profession,()=>{o.value.playerIds=[]});const z=()=>{if(!f.value)return;const e=new Set,a=new Set,l=[];f.value.forEach(t=>{e.add(t.profession);const d=`${t.id}:${t.profession}`;a.has(d)||(a.add(d),l.push({id:t.id,profession:t.profession}))}),w.value=Array.from(e).sort().map(t=>({label:t,value:t})),m.value=l},b=()=>{r.value=!0;try{const e=u.filterAverageDateData({playerIds:o.value.playerIds,profession:o.value.profession});f.value=e,z()}catch(e){console.error("加载数据失败:",e),$.error("加载数据失败")}finally{r.value=!1}},N=async()=>{r.value=!0;try{await u.getAllPlayerDateData()}catch(e){console.error("加载数据失败:",e),$.error("加载数据失败")}finally{r.value=!1}};I(()=>o.value.dateRange,()=>{b()}),j(async()=>{u.length||await N(),console.log("allPlayerDataStore",u),u.length||u.getPlayerProfessionData(),b()}),J();const T=e=>{_.value=!1};return(e,a)=>{const l=i("a-typography-title"),t=i("a-select"),d=i("a-space"),E=i("a-Image"),F=i("a-button"),O=i("a-table"),K=i("a-card");return y(),P("div",ae,[G(c(K,{class:"shadow-lg card-container"},{default:v(()=>[c(l,{level:4},{default:v(()=>a[2]||(a[2]=[x("平均分排名")])),_:1,__:[2]}),h("div",oe,[c(d,null,{default:v(()=>[c(t,{value:o.value.profession,"onUpdate:value":a[0]||(a[0]=s=>o.value.profession=s),options:w.value,placeholder:"选择职业",disabled:r.value,style:{width:"200px"},"allow-clear":""},null,8,["value","options","disabled"]),c(t,{value:o.value.playerIds,"onUpdate:value":a[1]||(a[1]=s=>o.value.playerIds=s),options:B.value,placeholder:"选择玩家",disabled:r.value,style:{width:"300px"},mode:"multiple","allow-clear":""},null,8,["value","options","disabled"])]),_:1})]),h("div",te,[c(O,{columns:A,"data-source":V.value,loading:r.value,scroll:{x:"100%",y:650},virtual:"",rowKey:s=>s.id+s.profession,pagination:{showSizeChanger:!0,pageSize:1e3,pageSizeOptions:["100","200","500","1000"],showTotal:s=>`共 ${s} 条数据`,position:["bottomRight"]}},{bodyCell:v(({column:s,record:p})=>[s.key==="id"?(y(),P(M,{key:0},[h("span",null,S(p.id),1),p.pin?(y(),D(E,{key:0,width:20,preview:!1,src:C(ee)},null,8,["src"])):g("",!0)],64)):g("",!0),s.key==="average"?(y(),D(F,{key:1,style:H({color:"#fff",background:C(Z)(p.average?p.average:"")})},{default:v(()=>[x(S(p.average?p.average:""),1)]),_:2},1032,["style"])):g("",!0)]),_:1},8,["data-source","loading","rowKey","pagination"])])]),_:1},512),[[L,!_.value]]),_.value?(y(),D(Y,{key:0,playerDetailData:q.value,onGoBack:T},null,8,["playerDetailData"])):g("",!0)])}}}),de=Q(se,[["__scopeId","data-v-8dd8e385"]]);export{de as default};
