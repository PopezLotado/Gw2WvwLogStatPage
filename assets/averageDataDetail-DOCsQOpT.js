import{d as j,r as u,c as k,w as I,o as z,b as F,l as G,m as x,n as S,v as L,e as r,f as i,g as p,h as $,i as g,j as D,u as _,p as H,t as C,q as J,k as m,_ as K}from"./index-C6yN1YY1.js";import{g as Q}from"./dataLoader-CT2r5VoL.js";import{a as W,P as X,g as Y}from"./PlayerDetail-C6s5PGdi.js";import{p as Z}from"./pin-NTqfuLeK.js";import{u as ee,V as ae}from"./table-mixins-BElgo4hX.js";const te={class:"data-detail"},oe={class:"mb-4"},le={class:"table-scroll-container"},se=j({__name:"averageDataDetail",setup(ne){const n=W(),{handleSortChange:V}=ee(),A=[{title:"玩家ID",dataIndex:"id",key:"id",width:200,flex:1},{title:"职业",dataIndex:"profession",key:"profession",flex:1,width:60,sorter:(e,a)=>e.profession-a.profession},{title:"平均分",dataIndex:"average",key:"average",width:120,flex:1,sorter:(e,a)=>e.average-a.average},{title:"出场次数",dataIndex:"frequency",key:"frequency",width:120,flex:1,sorter:(e,a)=>e.frequency-a.frequency},{title:"操作",key:"action",width:120}],d=u(!1),f=u([]),v=u(!1),h=u([]),y=u([]),B=Q(),w=u([]),t=u({dateRange:B,playerIds:[],profession:null}),q=k(()=>t.value.profession?y.value.filter(e=>e.profession===t.value.profession).sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})):y.value.sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`}))),R=k(()=>{if(!f.value)return[];let e=[];return f.value.forEach(a=>{const l=`${a.id}:${a.profession}`,o=!t.value.profession||a.profession===t.value.profession,c=t.value.playerIds.length===0||t.value.playerIds.includes(l);o&&c&&e.push({...a})}),e.sort((a,l)=>new Date(l.date).getTime()-new Date(a.date).getTime()),e});I(()=>t.value.profession,()=>{t.value.playerIds=[]});const T=()=>{if(!f.value)return;const e=new Set,a=new Set,l=[];f.value.forEach(o=>{e.add(o.profession);const c=`${o.id}:${o.profession}`;a.has(c)||(a.add(c),l.push({id:o.id,profession:o.profession}))}),h.value=Array.from(e).sort().map(o=>({label:o,value:o})),y.value=l},b=()=>{d.value=!0;try{const e=n.filterAverageDateData({playerIds:t.value.playerIds,profession:t.value.profession});f.value=e,T()}catch(e){console.error("加载数据失败:",e),$.error("加载数据失败")}finally{d.value=!1}},N=async()=>{d.value=!0;try{await n.getAllPlayerDateData()}catch(e){console.error("加载数据失败:",e),$.error("加载数据失败")}finally{d.value=!1}};I(()=>t.value.dateRange,()=>{b()}),z(async()=>{(!n.allPlayerData||n.allPlayerData.length===0)&&(await N(),n.getPlayerProfessionData()),console.log("allPlayerDataStore",n),b()}),J();const E=e=>{v.value=!0;const a=n.getPlayerAvailableDates(e.id,e.profession);let l=n.getSpecificPlayerDataByDate(e.id,e.profession,a[a.length-1]);console.log("handleViewDetail",l,a,e),w.value={date:l.date,score:l.score,playerId:e.id,profession:e.profession}},M=e=>{v.value=!1};return(e,a)=>{const l=p("a-typography-title"),o=p("a-select"),c=p("a-space"),O=p("a-Image"),P=p("a-button"),U=p("a-card");return m(),F("div",te,[G(r(U,{class:"shadow-lg card-container"},{default:i(()=>[r(l,{level:4},{default:i(()=>a[2]||(a[2]=[D("历史平均分排名")])),_:1,__:[2]}),g("div",oe,[r(c,null,{default:i(()=>[r(o,{value:t.value.profession,"onUpdate:value":a[0]||(a[0]=s=>t.value.profession=s),options:h.value,placeholder:"选择职业",disabled:d.value,style:{width:"200px"},"allow-clear":""},null,8,["value","options","disabled"]),r(o,{value:t.value.playerIds,"onUpdate:value":a[1]||(a[1]=s=>t.value.playerIds=s),options:q.value,placeholder:"选择玩家",disabled:d.value,style:{width:"300px"},mode:"multiple","allow-clear":""},null,8,["value","options","disabled"])]),_:1})]),g("div",le,[r(ae,{data:R.value,columns:A,"body-height":600,onSortChange:_(V),loading:d.value},{"cell-id":i(({row:s})=>[g("span",null,C(s.id),1),s.pin?(m(),x(O,{key:0,width:20,preview:!1,src:_(Z)},null,8,["src"])):S("",!0)]),"cell-average":i(({row:s})=>[r(P,{style:H({color:"#fff",background:_(Y)(s.average)})},{default:i(()=>[D(C(s.average),1)]),_:2},1032,["style"])]),"cell-action":i(({row:s})=>[r(P,{type:"link",onClick:re=>E(s)},{default:i(()=>a[3]||(a[3]=[D(" 查看明细 ")])),_:2,__:[3]},1032,["onClick"])]),_:1},8,["data","onSortChange","loading"])])]),_:1},512),[[L,!v.value]]),v.value?(m(),x(X,{key:0,playerDetailData:w.value,onGoBack:M},null,8,["playerDetailData"])):S("",!0)])}}}),fe=K(se,[["__scopeId","data-v-4b191ed8"]]);export{fe as default};
