import{d as z,r as i,c as k,w as b,o as A,b as $,l as x,v as I,e as r,f,g as d,h as G,i as L,j as y,m as C,n as M,F as T,t as q,a as P,p as H,k as m,_ as J}from"./index-B4Io9oQG.js";import{g as K,l as Q}from"./dataLoader-Bdaaaglp.js";import W from"./PlayerDetail-FSryKfNf.js";import"./install-CUrr3PG9.js";const X={class:"data-detail"},Y={class:"mb-4"},Z=z({__name:"DataDetail",setup(ee){const R=[{title:"日期",dataIndex:"date",key:"date",width:120,sorter:(e,a)=>P(e.date).valueOf()-P(a.date).valueOf()},{title:"玩家ID",dataIndex:"id",key:"id",width:200},{title:"职业",dataIndex:"profession",key:"profession",width:120},{title:"评分",dataIndex:"score",key:"score",width:120,sorter:(e,a)=>e.score-a.score},{title:"操作",key:"action",width:120,fixed:"right"}],u=i(!1),c=i([]),v=i(!1),h=i([]),_=i([]),S=K(),g=i([]),o=i({dateRange:S,playerIds:[],profession:null}),V=k(()=>o.value.profession?_.value.filter(e=>e.profession===o.value.profession).sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})):_.value.sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`}))),B=k(()=>{if(!c.value)return[];let e=[];return c.value.forEach(a=>{a.data.forEach(s=>{const l=`${s.id}:${s.profession}`,t=!o.value.profession||s.profession===o.value.profession,p=o.value.playerIds.length===0||o.value.playerIds.includes(l);t&&p&&e.push({key:`${a.date}-${l}`,date:a.date,...s})})}),e});b(()=>o.value.profession,()=>{o.value.playerIds=[]});const E=()=>{if(!c.value)return;const e=new Set,a=new Set,s=[];c.value.forEach(l=>{l.data.forEach(t=>{e.add(t.profession);const p=`${t.id}:${t.profession}`;a.has(p)||(a.add(p),s.push({id:t.id,profession:t.profession}))})}),h.value=Array.from(e).sort().map(l=>({label:l,value:l})),_.value=s},w=async()=>{u.value=!0;try{const e=await Q({dateRange:o.value.dateRange,playerIds:[],profession:null});c.value=e,E()}catch(e){console.error("加载数据失败:",e),G.error("加载数据失败")}finally{u.value=!1}};b(()=>o.value.dateRange,()=>{w()}),A(()=>{w()}),H();const F=e=>{v.value=!0,g.value={date:e.date,playerId:e.id,profession:e.profession}},N=e=>{v.value=!1};return(e,a)=>{const s=d("a-typography-title"),l=d("a-range-picker"),t=d("a-select"),p=d("a-space"),O=d("a-button"),U=d("a-table"),j=d("a-card");return m(),$("div",X,[x(r(j,{class:"shadow-lg"},{default:f(()=>[r(s,{level:4},{default:f(()=>a[3]||(a[3]=[y("数据明细")])),_:1,__:[3]}),L("div",Y,[r(p,null,{default:f(()=>[r(l,{value:o.value.dateRange,"onUpdate:value":a[0]||(a[0]=n=>o.value.dateRange=n),disabled:u.value,style:{width:"280px"}},null,8,["value","disabled"]),r(t,{value:o.value.profession,"onUpdate:value":a[1]||(a[1]=n=>o.value.profession=n),options:h.value,placeholder:"选择职业",disabled:u.value,style:{width:"200px"},"allow-clear":""},null,8,["value","options","disabled"]),r(t,{value:o.value.playerIds,"onUpdate:value":a[2]||(a[2]=n=>o.value.playerIds=n),options:V.value,placeholder:"选择玩家",disabled:u.value,style:{width:"300px"},mode:"multiple","allow-clear":""},null,8,["value","options","disabled"])]),_:1})]),r(U,{columns:R,"data-source":B.value,loading:u.value,pagination:{showSizeChanger:!0}},{bodyCell:f(({column:n,record:D})=>[n.key==="score"?(m(),$(T,{key:0},[y(q(D.score.toFixed(2)),1)],64)):C("",!0),n.key==="action"?(m(),M(O,{key:1,type:"link",onClick:ae=>F(D)},{default:f(()=>a[4]||(a[4]=[y(" 查看明细 ")])),_:2,__:[4]},1032,["onClick"])):C("",!0)]),_:1},8,["data-source","loading"])]),_:1},512),[[I,!v.value]]),x(r(W,{playerDetailData:g.value,onGoBack:N},null,8,["playerDetailData"]),[[I,v.value]])])}}}),ne=J(Z,[["__scopeId","data-v-42791716"]]);export{ne as default};
