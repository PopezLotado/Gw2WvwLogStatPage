import{d as N,r as c,c as k,w,o as O,b,e as r,f,g as d,h as U,i as j,j as _,l as $,m as q,F as z,t as A,a as x,n as L,k as y,_ as M}from"./index-C6kLQFz1.js";import{g as T,l as G}from"./dataLoader-cU_V8qah.js";const H={class:"data-detail"},J={class:"mb-4"},K=N({__name:"DataDetail",setup(Q){const I=[{title:"日期",dataIndex:"date",key:"date",width:120,sorter:(e,a)=>x(e.date).valueOf()-x(a.date).valueOf()},{title:"玩家ID",dataIndex:"id",key:"id",width:200},{title:"职业",dataIndex:"profession",key:"profession",width:120},{title:"评分",dataIndex:"score",key:"score",width:120,sorter:(e,a)=>e.score-a.score},{title:"操作",key:"action",width:120,fixed:"right"}],i=c(!1),p=c([]),m=c([]),v=c([]),D=T(),o=c({dateRange:D,playerIds:[],profession:null}),C=k(()=>o.value.profession?v.value.filter(e=>e.profession===o.value.profession).sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})):v.value.sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`}))),R=k(()=>{if(!p.value)return[];let e=[];return p.value.forEach(a=>{a.data.forEach(s=>{const l=`${s.id}:${s.profession}`,t=!o.value.profession||s.profession===o.value.profession,u=o.value.playerIds.length===0||o.value.playerIds.includes(l);t&&u&&e.push({key:`${a.date}-${l}`,date:a.date,...s})})}),e});w(()=>o.value.profession,()=>{o.value.playerIds=[]});const P=()=>{if(!p.value)return;const e=new Set,a=new Set,s=[];p.value.forEach(l=>{l.data.forEach(t=>{e.add(t.profession);const u=`${t.id}:${t.profession}`;a.has(u)||(a.add(u),s.push({id:t.id,profession:t.profession}))})}),m.value=Array.from(e).sort().map(l=>({label:l,value:l})),v.value=s},g=async()=>{i.value=!0;try{const e=await G({dateRange:o.value.dateRange,playerIds:[],profession:null});p.value=e,P()}catch(e){console.error("加载数据失败:",e),U.error("加载数据失败")}finally{i.value=!1}};w(()=>o.value.dateRange,()=>{g()}),O(()=>{g()});const S=L(),E=e=>{S.push({name:"player-detail",query:{date:e.date,playerId:e.id,profession:e.profession}})};return(e,a)=>{const s=d("a-typography-title"),l=d("a-range-picker"),t=d("a-select"),u=d("a-space"),F=d("a-button"),V=d("a-table"),B=d("a-card");return y(),b("div",H,[r(B,{class:"shadow-lg"},{default:f(()=>[r(s,{level:4},{default:f(()=>a[3]||(a[3]=[_("数据明细")])),_:1,__:[3]}),j("div",J,[r(u,null,{default:f(()=>[r(l,{value:o.value.dateRange,"onUpdate:value":a[0]||(a[0]=n=>o.value.dateRange=n),disabled:i.value,style:{width:"280px"}},null,8,["value","disabled"]),r(t,{value:o.value.profession,"onUpdate:value":a[1]||(a[1]=n=>o.value.profession=n),options:m.value,placeholder:"选择职业",disabled:i.value,style:{width:"200px"},"allow-clear":""},null,8,["value","options","disabled"]),r(t,{value:o.value.playerIds,"onUpdate:value":a[2]||(a[2]=n=>o.value.playerIds=n),options:C.value,placeholder:"选择玩家",disabled:i.value,style:{width:"300px"},mode:"multiple","allow-clear":""},null,8,["value","options","disabled"])]),_:1})]),r(V,{columns:I,"data-source":R.value,loading:i.value,pagination:{showSizeChanger:!0}},{bodyCell:f(({column:n,record:h})=>[n.key==="score"?(y(),b(z,{key:0},[_(A(h.score.toFixed(2)),1)],64)):$("",!0),n.key==="action"?(y(),q(F,{key:1,type:"link",onClick:W=>E(h)},{default:f(()=>a[4]||(a[4]=[_(" 查看明细 ")])),_:2,__:[4]},1032,["onClick"])):$("",!0)]),_:1},8,["data-source","loading"])]),_:1})])}}}),Z=M(K,[["__scopeId","data-v-6d552049"]]);export{Z as default};
