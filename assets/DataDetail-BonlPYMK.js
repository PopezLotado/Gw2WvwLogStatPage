import{d as O,r as i,c as b,w as $,o as U,b as A,l as x,v as I,e as r,f as c,g as d,h as j,i as q,j as g,m as C,n as P,t as G,p as L,u as M,q as H,k as m,_ as J}from"./index-C4s78o-k.js";import{g as K,l as Q}from"./dataLoader-ne8s10U6.js";import{P as W,g as X}from"./PlayerDetail-D80MorQN.js";import"./install-BhaJYa61.js";const Y={class:"data-detail"},Z={class:"mb-4"},ee=O({__name:"DataDetail",setup(ae){const S=[{title:"日期",dataIndex:"date",key:"date",width:120,sorter:(e,a)=>(console.log(`排序比较: ${e.date} vs ${a.date}`),new Date(a.date).getTime()-new Date(e.date).getTime())},{title:"玩家ID",dataIndex:"id",key:"id",width:200},{title:"职业",dataIndex:"profession",key:"profession",width:120},{title:"评分",dataIndex:"score",key:"score",width:120,sorter:(e,a)=>e.score-a.score},{title:"操作",key:"action",width:120,fixed:"right"}],u=i(!1),f=i([]),v=i(!1),w=i([]),y=i([]),R=K(),h=i([]),t=i({dateRange:R,playerIds:[],profession:null}),T=b(()=>t.value.profession?y.value.filter(e=>e.profession===t.value.profession).sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`})):y.value.sort((e,a)=>e.id.localeCompare(a.id)).map(e=>({label:`${e.id} (${e.profession})`,value:`${e.id}:${e.profession}`}))),V=b(()=>{if(!f.value)return[];let e=[];return f.value.forEach(a=>{a.data.forEach(o=>{const n=`${o.id}:${o.profession}`,s=!t.value.profession||o.profession===t.value.profession,p=t.value.playerIds.length===0||t.value.playerIds.includes(n);s&&p&&e.push({key:`${a.date}-${n}`,date:a.date,...o})})}),e.sort((a,o)=>new Date(o.date).getTime()-new Date(a.date).getTime()),e});$(()=>t.value.profession,()=>{t.value.playerIds=[]});const B=()=>{if(!f.value)return;const e=new Set,a=new Set,o=[];f.value.forEach(n=>{n.data.forEach(s=>{e.add(s.profession);const p=`${s.id}:${s.profession}`;a.has(p)||(a.add(p),o.push({id:s.id,profession:s.profession}))})}),w.value=Array.from(e).sort().map(n=>({label:n,value:n})),y.value=o},D=async()=>{u.value=!0;try{const e=await Q({dateRange:t.value.dateRange,playerIds:[],profession:null});f.value=e,B()}catch(e){console.error("加载数据失败:",e),j.error("加载数据失败")}finally{u.value=!1}};$(()=>t.value.dateRange,()=>{D()}),U(()=>{D()}),H();const E=e=>{v.value=!0,h.value={date:e.date,score:Number(e.score.toFixed(2)),playerId:e.id,profession:e.profession}},F=e=>{v.value=!1};return(e,a)=>{const o=d("a-typography-title"),n=d("a-range-picker"),s=d("a-select"),p=d("a-space"),k=d("a-button"),N=d("a-table"),z=d("a-card");return m(),A("div",Y,[x(r(z,{class:"shadow-lg"},{default:c(()=>[r(o,{level:4},{default:c(()=>a[3]||(a[3]=[g("数据明细")])),_:1,__:[3]}),q("div",Z,[r(p,null,{default:c(()=>[r(n,{value:t.value.dateRange,"onUpdate:value":a[0]||(a[0]=l=>t.value.dateRange=l),disabled:u.value,style:{width:"280px"}},null,8,["value","disabled"]),r(s,{value:t.value.profession,"onUpdate:value":a[1]||(a[1]=l=>t.value.profession=l),options:w.value,placeholder:"选择职业",disabled:u.value,style:{width:"200px"},"allow-clear":""},null,8,["value","options","disabled"]),r(s,{value:t.value.playerIds,"onUpdate:value":a[2]||(a[2]=l=>t.value.playerIds=l),options:T.value,placeholder:"选择玩家",disabled:u.value,style:{width:"300px"},mode:"multiple","allow-clear":""},null,8,["value","options","disabled"])]),_:1})]),r(N,{columns:S,"data-source":V.value,loading:u.value,pagination:{showSizeChanger:!0,pageSize:500,pageSizeOptions:["200","400","500","1000"],showTotal:l=>`共 ${l} 条数据`}},{bodyCell:c(({column:l,record:_})=>[l.key==="score"?(m(),C(k,{key:0,style:L({color:"#fff",background:M(X)(_.score.toFixed(2))})},{default:c(()=>[g(G(_.score.toFixed(2)),1)]),_:2},1032,["style"])):P("",!0),l.key==="action"?(m(),C(k,{key:1,type:"link",onClick:te=>E(_)},{default:c(()=>a[4]||(a[4]=[g(" 查看明细 ")])),_:2,__:[4]},1032,["onClick"])):P("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1},512),[[I,!v.value]]),x(r(W,{playerDetailData:h.value,onGoBack:F},null,8,["playerDetailData"]),[[I,v.value]])])}}}),re=J(ee,[["__scopeId","data-v-46ba3333"]]);export{re as default};
